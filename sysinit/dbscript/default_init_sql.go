package dbscript

var (
	// job
	DefaultDockerBenchJobSql        = `DO $do$ BEGIN IF NOT EXISTS (SELECT from job WHERE id='9b4320a4-57f5-4559-a91b-d84b0d0a0e01') THEN INSERT INTO "public"."job" VALUES ('9b4320a4-57f5-4559-a91b-d84b0d0a0e01', 'admin', 'docker基线检查', '系统任务-docker基线检查', '', 'Once', 'DockerBenchMark', 'Enable', '1589795318000', '1589795318000', '9b4320a4-57f5-4559-a91b-d84b0d0a0e99', NULL);  END IF; END $do$;`
	DefaultK8sBenchJobSql           = `DO $do$ BEGIN IF NOT EXISTS (SELECT from job WHERE id='9b4320a4-57f5-4559-a91b-d84b0d0a0e02') THEN INSERT INTO "public"."job" VALUES ('9b4320a4-57f5-4559-a91b-d84b0d0a0e02', 'admin', 'k8s基线检查', '系统任务-k8s基线检查', '', 'Once', 'KubernetesBenchMark', 'Enable',  '1589795318000', '1589795318000','9b4320a4-57f5-4559-a91b-d84b0d0a0f01', NULL); END IF; END $do$;`
	DefaultContainerVirusScanJobSql = `DO $do$ BEGIN IF NOT EXISTS (SELECT from job WHERE id='9b4320a4-57f5-4559-a91b-d84b0d0a0e03') THEN INSERT INTO "public"."job" VALUES ('9b4320a4-57f5-4559-a91b-d84b0d0a0e03', 'admin', '容器病毒扫描', '系统任务-容器病毒扫描', '', 'Once', 'ContainerVirusScan', 'Enable',  '1589795318000', '1589795318000','9b4320a4-57f5-4559-a91b-d84b0d0a0e90', NULL); END IF; END $do$;`
	DefaultHostVirusScanJobSql      = `DO $do$ BEGIN IF NOT EXISTS (SELECT from job WHERE id='9b4320a4-57f5-4559-a91b-d84b0d0a0e04') THEN INSERT INTO "public"."job" VALUES ('9b4320a4-57f5-4559-a91b-d84b0d0a0e04', 'admin', '主机病毒扫描', '系统任务-主机病毒扫描', '', 'Once', 'HostVirusScan', 'Enable',  '1589795318000', '1589795318000','9b4320a4-57f5-4559-a91b-d84b0d0a0e91', NULL, 'System'); END IF; END $do$;`
	DefaultImageVirusScanJobSql     = `DO $do$ BEGIN IF NOT EXISTS (SELECT from job WHERE id='9b4320a4-57f5-4559-a91b-d84b0d0a0e07') THEN INSERT INTO "public"."job" VALUES ('9b4320a4-57f5-4559-a91b-d84b0d0a0e07', 'admin', '镜像病毒扫描', '系统任务-镜像病毒扫描', '', 'Once', 'ImageVirusScan', 'Enable',  '1589795318000', '1589795318000','9b4320a4-57f5-4559-a91b-d84b0d0a0e95', NULL); END IF; END $do$;`
	DefaultHostImageVlunScanJobSql  = `DO $do$ BEGIN IF NOT EXISTS (SELECT from job WHERE id='9b4320a4-57f5-4559-a91b-d84b0d0a0e05') THEN INSERT INTO "public"."job" ("id","account","name","description","spec","type","system_template_type","status","create_time","update_time","system_template_id","system_template_group_id","job_level") VALUES ('9b4320a4-57f5-4559-a91b-d84b0d0a0e05','admin','主机镜像漏洞扫描','系统任务-主机镜像漏洞扫描','','Once','HostImageVulnScan','Enable','1589795318000','1589795318000','9b4320a4-57f5-4559-a91b-d84b0d0a0e92',NULL,'System'); END IF; END $do$;`
	DefaultImageVlunScanJobSql      = `DO $do$ BEGIN IF NOT EXISTS (SELECT from job WHERE id='9b4320a4-57f5-4559-a91b-d84b0d0a0e06') THEN INSERT INTO "public"."job" ("id","account","name","description","spec","type","system_template_type","status","create_time","update_time","system_template_id","system_template_group_id","job_level") VALUES ('9b4320a4-57f5-4559-a91b-d84b0d0a0e06','admin','镜像漏洞扫描','系统任务-镜像漏洞扫描','','Once','ImageVulnScan','Enable','1589795318000','1589795318000','9b4320a4-57f5-4559-a91b-d84b0d0a0e93',NULL,'System'); END IF; END $do$;`
	DefaultKubeVlunScanJobSql       = `DO $do$ BEGIN IF NOT EXISTS (SELECT from job WHERE id='9b4320a4-57f5-4559-a91b-d84b0d0a0e08') THEN INSERT INTO "public"."job" ("id","account","name","description","spec","type","system_template_type","status","create_time","update_time","system_template_id","system_template_group_id","job_level") VALUES ('9b4320a4-57f5-4559-a91b-d84b0d0a0e08','admin','集群漏洞扫描','系统任务-集群漏洞扫描','','Once','KubernetesVulnScan','Enable','1589795318000','1589795318000','9b4320a4-57f5-4559-a91b-d84b0d0a0e93',NULL,'System'); END IF; END $do$;`
	DefaultDockerVlunScanJobSql     = `DO $do$ BEGIN IF NOT EXISTS (SELECT from job WHERE id='9b4320a4-57f5-4559-a91b-d84b0d0a0e09') THEN INSERT INTO public.job (id, account, name, description, spec, type, system_template_type, status, create_time, update_time, system_template_id, system_template_group_id, job_level) VALUES ('9b4320a4-57f5-4559-a91b-d84b0d0a0e09', 'admin', 'Docker漏洞扫描', '系统任务-Docker漏洞扫描', '', 'Once', 'DockerVulnScan', 'Enable', 1589795318000, 1589795318000, '9b4320a4-57f5-4559-a91b-d84b0d0a0e96', null, 'System'); END IF; END $do$;`

	// template - VirusScan
	DefaultContainerVirusScanSql = `DO $do$ BEGIN IF NOT EXISTS (SELECT from system_template WHERE id='9b4320a4-57f5-4559-a91b-d84b0d0a0e90') THEN INSERT INTO public.system_template (id, account, name, description, type, version, commands, status, is_default, config_mode, default_targets, check_master_json, check_node_json, check_control_plane_json, check_etcd_json, check_policies_json, check_managed_services_json, check_ids_master, check_ids_node, check_ids_control_plane, check_ids_etcd, check_ids_policies, check_ids_managed_services, check_ids_docker, check_ids_docker_check) VALUES ('9b4320a4-57f5-4559-a91b-d84b0d0a0e90', 'admin', '容器病毒扫描', '', 'ContainerVirusScan', '1.0', 'docker run --rm -m 2048M --cpu-period=50000 --cpu-quota=25000 -v /var/run/docker.sock:/var/run/docker.sock -v clamav-db:/var/lib/clamav/ -v /:/host/:ro registry.cn-qingdao.aliyuncs.com/diss/amclean:1.1.0 /usr/bin/amclean', 'Enable', true,  null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null); END IF; END $do$;`
	DefaultHostVirusScanSql      = `DO $do$ BEGIN IF NOT EXISTS (SELECT from system_template WHERE id='9b4320a4-57f5-4559-a91b-d84b0d0a0e91') THEN INSERT INTO public.system_template (id, account, name, description, type, version, commands, status, is_default, config_mode, default_targets, check_master_json, check_node_json, check_control_plane_json, check_etcd_json, check_policies_json, check_managed_services_json, check_ids_master, check_ids_node, check_ids_control_plane, check_ids_etcd, check_ids_policies, check_ids_managed_services, check_ids_docker, check_ids_docker_check) VALUES ('9b4320a4-57f5-4559-a91b-d84b0d0a0e91', 'admin', '主机病毒扫描', '', 'HostVirusScan', '1.0', 'docker run --rm -m 2048M --cpu-period=50000 --cpu-quota=25000 -v /var/run/docker.sock:/var/run/docker.sock -v clamav-db:/var/lib/clamav/ -v /:/host/:ro registry.cn-qingdao.aliyuncs.com/diss/amclean:1.1.0 /usr/bin/amclean host', 'Enable', true,  null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null); END IF; END $do$;`
	DefaultImageVirusScanSql     = `DO $do$ BEGIN IF NOT EXISTS (SELECT from system_template WHERE id='9b4320a4-57f5-4559-a91b-d84b0d0a0e95') THEN INSERT INTO public.system_template (id, account, name, description, type, version, commands, status, is_default, config_mode, default_targets, check_master_json, check_node_json, check_control_plane_json, check_etcd_json, check_policies_json, check_managed_services_json, check_ids_master, check_ids_node, check_ids_control_plane, check_ids_etcd, check_ids_policies, check_ids_managed_services, check_ids_docker, check_ids_docker_check) VALUES ('9b4320a4-57f5-4559-a91b-d84b0d0a0e95', 'admin', '镜像病毒扫描', '', 'ImageVirusScan', '1.0', 'docker run --rm -m 2048M --cpu-period=50000 --cpu-quota=25000 -v /var/run/docker.sock:/var/run/docker.sock -v clamav-db:/var/lib/clamav/ -v /:/host/:ro registry.cn-qingdao.aliyuncs.com/diss/amclean:1.1.0 /usr/bin/amclean', 'Enable', true,  null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null); END IF; END $do$;`
	// template - DockerBench
	DefaultDockerBenchSql = `DO $do$ BEGIN IF NOT EXISTS (SELECT from public.system_template WHERE id='9b4320a4-57f5-4559-a91b-d84b0d0a0e99') THEN INSERT INTO public.system_template (id, account, name, description, type, version, commands, status, is_default, config_mode, default_targets, check_master_json, check_node_json, check_control_plane_json, check_etcd_json, check_policies_json, check_managed_services_json, check_ids_master, check_ids_node, check_ids_control_plane, check_ids_etcd, check_ids_policies, check_ids_managed_services, check_ids_docker, check_ids_docker_check) VALUES ('9b4320a4-57f5-4559-a91b-d84b0d0a0e99', 'admin', 'CIS标准-Docker Benchmark', '', 'DockerBenchMark', 'v.1.3.5', 'docker run --rm --net host --pid host --cap-add audit_control     -e DOCKER_CONTENT_TRUST=$DOCKER_CONTENT_TRUST      -v /var/lib:/var/lib:ro     -v /var/run/docker.sock:/var/run/docker.sock:ro       -v /usr/lib/systemd:/usr/lib/systemd:ro     -v /etc:/etc:ro    --label docker_bench_security  registry.cn-qingdao.aliyuncs.com/diss/docker-bench-security:v.1.3.5  -o json -t cn', 'Enable', true, null, null, '{"DockerbenchSecurity":"1.3.5","Tests":[{"Id":"1","Desc":"Docker主机配置","Checks":[{"Id":"1.1.1","Desc":"加固容器宿主机 (不计评分)","CheckId":"check_1_1_1"},{"Id":"1.1.2","Desc":"保持Docker版本更新 (不计评分)","CheckId":"check_1_1_2"},{"Id":"1.2.1","Desc":"为容器创建一个单独的分区 (计入评分)","CheckId":"check_1_2_1"},{"Id":"1.2.2","Desc":"只有受信任的用户才能控制 docker 守护进程  (计入评分)","CheckId":"check_1_2_2"},{"Id":"1.2.3","Desc":"审计docker守护进程 (计入评分)","CheckId":"check_1_2_3"},{"Id":"1.2.4","Desc":"审计docker文件和目录-/var/lib/docker - /var/lib/docker (计入评分)","CheckId":"check_1_2_3"},{"Id":"1.2.5","Desc":"审计docker文件和目录 - /etc/docker (计入评分)","CheckId":"check_1_2_5"},{"Id":"1.2.6","Desc":"审计docker文件和目录 - docker.service (计入评分)","CheckId":"check_1_2_6"},{"Id":"1.2.7","Desc":"审计docker文件和目录 - docker.socket (计入评分)","CheckId":"check_1_2_7"},{"Id":"1.2.8","Desc":"审计docker文件和目录 - /etc/default/docker (计入评分)","CheckId":"check_1_2_8"},{"Id":"1.2.9","Desc":"审计docker文件和目录 - /etc/sysconfig/docker (计入评分)","CheckId":"check_1_2_9"},{"Id":"1.2.10","Desc":"审计docker文件和目录 - /etc/docker/daemon.json (计入评分)","CheckId":"check_1_2_10"},{"Id":"1.2.11","Desc":"审计docker文件和目录 - /usr/bin/containerd (计入评分)","CheckId":"check_1_2_11"},{"Id":"1.2.12","Desc":"审计docker文件和目录 - /usr/sbin/runc (计入评分)","CheckId":"check_1_2_12"}]},{"Id":"2","Desc":"Docker 守护进程安全配置","Checks":[{"Id":"2.1","Desc":"限制默认网桥上容器之间的网络流量 (计入评分)","CheckId":"check_2_1"},{"Id":"2.2","Desc":"设置日志级别为info (计入评分)","CheckId":"check_2_2"},{"Id":"2.3","Desc":"允许docker更改IPtables (计入评分)","CheckId":"check_2_3"},{"Id":"2.4","Desc":"不使用不安全的镜像仓库 (计入评分)","CheckId":"check_2_4"},{"Id":"2.5","Desc":"不使用aufs存储驱动程序 (计入评分)","CheckId":"check_2_5"},{"Id":"2.6","Desc":"docker守护进程配置TLS身份认证 (计入评分)","CheckId":"check_2_6"},{"Id":"2.7","Desc":"配置合适的ulimit (不计评分)","CheckId":"check_2_7"},{"Id":"2.8","Desc":"启用用户命名空间 (计入评分)","CheckId":"check_2_8"},{"Id":"2.9","Desc":"使用默认cgroup (计入评分)","CheckId":"check_2_9"},{"Id":"2.10","Desc":"设置容器的默认空间大小 (计入评分)","CheckId":"check_2_10"},{"Id":"2.11","Desc":"启用docker客户端命令的授权 (计入评分)","CheckId":"check_2_11"},{"Id":"2.12","Desc":"配置集中和远程日志记录 (计入评分)","CheckId":"check_2_12"},{"Id":"2.13","Desc":"启用实时恢复 (计入评分)","CheckId":"check_2_13"},{"Id":"2.14","Desc":"禁用userland代理 (计入评分)","CheckId":"check_2_14"},{"Id":"2.15","Desc":"应用守护进程范围的自定义seccomp配置文件 (不计评分)","CheckId":"check_2_15"},{"Id":"2.16","Desc":"生产环境中避免实验性功能 (计入评分)","CheckId":"check_2_16"},{"Id":"2.17","Desc":"限制容器获取新的权限 (计入评分)","CheckId":"check_2_17"},{"Id":"2.18","Desc":"docker API暴露在外 (计入评分)","CheckId":"check_2_18"}]},{"Id":"3","Desc":"Docker 守护进程文件权限配置","Checks":[{"Id":"3.1","Desc":"设置docker.service文件的所有权为 root:root (计入评分)","CheckId":"check_3_1"},{"Id":"3.2","Desc":"设置docker.service文件权限为644或更多限制性 (计入评分)","CheckId":"check_3_2"},{"Id":"3.3","Desc":"设置docker.socket文件所有权为 root:root (计入评分)","CheckId":"check_3_3"},{"Id":"3.4","Desc":"设置docker.socket文件权限为644或更多限制性 (计入评分)","CheckId":"check_3_4"},{"Id":"3.5","Desc":"设置/etc/docker目录所有权为 root:root (计入评分)","CheckId":"check_3_5"},{"Id":"3.6","Desc":"chmod 755 /etc/docker这将把目录的权限设置为755。","CheckId":"check_3_6"},{"Id":"3.7","Desc":"设置仓库证书文件所有权为root:root (计入评分)","CheckId":"check_3_7"},{"Id":"3.8","Desc":"设置仓库证书文件权限为444或更多限制性 (计入评分)","CheckId":"check_3_8"},{"Id":"3.9","Desc":"设置TLS CA证书文件所有权为root:root (计入评分)","CheckId":"check_3_9"},{"Id":"3.10","Desc":"设置TLS CA证书文件权限为444或更多限制性 (计入评分)","CheckId":"check_3_10"},{"Id":"3.11","Desc":"设置docker服务器证书文件所有权为root:root (计入评分)","CheckId":"check_3_11"},{"Id":"3.12","Desc":"设置docker服务器证书文件权限为444或更多限制 (计入评分)","CheckId":"check_3_12"},{"Id":"3.13","Desc":"设置docker服务器证书密钥文件所有权为 root:root (计入评分)","CheckId":"check_3_13"},{"Id":"3.14","Desc":"设置docker服务器证书密钥文件权限为400 (计入评分)","CheckId":"check_3_14"},{"Id":"3.15","Desc":"设置docker.sock文件所有权为 root:docker (计入评分)","CheckId":"check_3_15"},{"Id":"3.16","Desc":"设置docker.sock文件权限为660或更多限制性 (计入评分)","CheckId":"check_3_16"},{"Id":"3.17","Desc":"设置daemon.json文件所有权为 root:root (计入评分)","CheckId":"check_3_17"},{"Id":"3.18","Desc":"设置daemon.json文件权限为644或更多限制性 (计入评分)","CheckId":"check_3_18"},{"Id":"3.19","Desc":"设置/etc/default/docker文件所有权为 root:root (计入评分)","CheckId":"check_3_19"},{"Id":"3.20","Desc":"设置/etc/default/docker文件权限为644或更多限制性 root:root (计入评分)","CheckId":"check_3_20"},{"Id":"3.21","Desc":"设置/etc/sysconfig/docker的文件权限为644或更多的限制性 (计入评分)","CheckId":"check_3_21"},{"Id":"3.22","Desc":"设置/etc/default/docker的文件权限为644或更多的限制性 (计入评分)","CheckId":"check_3_22"}]},{"Id":"4","Desc":"容器镜像和构建文件","Checks":[{"Id":"4.1","Desc":"创建容器的用户 (计入评分)","CheckId":"check_4_1"},{"Id":"4.2","Desc":"容器使用可信的基础镜像 (不计评分)","CheckId":"check_4_2"},{"Id":"4.3","Desc":"容器中不安装没有必要的软件包 (不计评分)","CheckId":"check_4_3"},{"Id":"4.4","Desc":"扫描镜像漏洞并且构建包含安全补丁的镜像 (不计评分)","CheckId":"check_4_4"},{"Id":"4.5","Desc":"启用 docker 内容信任 (计入评分)","CheckId":"check_4_5"},{"Id":"4.6","Desc":"将 HEALTHCHECK 说明添加到容器镜像 (计入评分)","CheckId":"check_4_6"},{"Id":"4.7","Desc":"不在 dockerfile 中单独使用更新命令 (不计评分)","CheckId":"check_4_7"},{"Id":"4.8","Desc":"镜像中删除 setuid 和 setgid 权限 (不计评分)","CheckId":"check_4_8"},{"Id":"4.9","Desc":"在 dockerfile 中使用 COPY 而不是 ADD  (不计评分)","CheckId":"check_4_9"},{"Id":"4.10","Desc":"涉密信息不存储在 Dockerfiles (不计评分)","CheckId":"check_4_10"},{"Id":"4.11","Desc":"仅安装已经验证的软件包 (不计评分)","CheckId":"check_4_11"}]},{"Id":"5","Desc":"容器运行时保护","Checks":[{"Id":"5.1","Desc":"启用 AppArmor 配置文件 (计入评分)","CheckId":"check_5_1"},{"Id":"5.2","Desc":"设置 SElinux 安全选项 (计入评分)","CheckId":"check_5_2"},{"Id":"5.3","Desc":"linux 内核功能在容器内受限 (计入评分)","CheckId":"check_5_3"},{"Id":"5.4","Desc":"不使用特权容器 (计入评分)","CheckId":"check_5_4"},{"Id":"5.5","Desc":"敏感的主机系统目录未挂载在容器上 (计入评分)","CheckId":"check_5_5"},{"Id":"5.6","Desc":"sshd不在容器中运行 (计入评分)","CheckId":"check_5_6"},{"Id":"5.7","Desc":"特权端口禁止映射到容器内 (计入评分)","CheckId":"check_5_7"},{"Id":"5.8","Desc":"只映射必要的端口只映射必要的端口 (不计评分)","CheckId":"check_5_8"},{"Id":"5.9","Desc":"不共享主机的网络命名空间 (计入评分)","CheckId":"check_5_9"},{"Id":"5.10","Desc":"确保容器的内存使用合理 (计入评分)","CheckId":"check_5_10"},{"Id":"5.11","Desc":"正确设置容器上的 CPU 优先级 (计入评分)","CheckId":"check_5_11"},{"Id":"5.12","Desc":"设置容器的根文件系统为只读 (计入评分)","CheckId":"check_5_12"},{"Id":"5.13","Desc":"确保进入容器的流量绑定到特定的主机接口 (计入评分)","CheckId":"check_5_13"},{"Id":"5.14","Desc":"容器重启策略 on-failure 设置为 5  (计入评分)","CheckId":"check_5_14"},{"Id":"5.15","Desc":"确保主机的进程命名空间不共享 (计入评分)","CheckId":"check_5_15"},{"Id":"5.16","Desc":"主机的 IPC 命令空间不共享 (计入评分)","CheckId":"check_5_16"},{"Id":"5.17","Desc":"主机设备不直接共享给容器 (不计评分)","CheckId":"check_5_17"},{"Id":"5.18","Desc":"设置默认的 ulimit 配置（在需要时） (不计评分)","CheckId":"check_5_18"},{"Id":"5.19","Desc":"设置装载传播模式不共享 (计入评分)","CheckId":"check_5_19"},{"Id":"5.20","Desc":"设置主机的 UTS 命令空间不共享 (计入评分)","CheckId":"check_5_20"},{"Id":"5.21","Desc":"默认的 seccomp 配置文件未禁用 (计入评分)","CheckId":"check_5_21"},{"Id":"5.22","Desc":"docker exec 命令不能使用特权选项n (计入评分)","CheckId":"check_5_22"},{"Id":"5.23","Desc":"docker exec 命令不能与 uuser=root 选项一起使用 (不计评分)","CheckId":"check_5_23"},{"Id":"5.24","Desc":"确保 cgroug 安全使用 (计入评分)","CheckId":"check_5_24"},{"Id":"5.25","Desc":"限制容器获得额外的权限 (计入评分)","CheckId":"check_5_25"},{"Id":"5.26","Desc":"运行时检查容器健康状态 (计入评分)","CheckId":"check_5_26"},{"Id":"5.27","Desc":"确保 docker 命令始终获取最新版本的镜像 (不计评分)","CheckId":"check_5_27"},{"Id":"5.28","Desc":"限制使用 PID cgroup (计入评分)","CheckId":"check_5_28"},{"Id":"5.29","Desc":"不要使用 docker 的默认网桥 docker0 (不计评分)","CheckId":"check_5_29"},{"Id":"5.30","Desc":"不共享主机的用户命名空间 (计入评分)","CheckId":"check_5_30"},{"Id":"5.31","Desc":"任何容器内不能安装 docker 套接字 (计入评分)","CheckId":"check_5_31"}]},{"Id":"6","Desc":"Docker 安全操作","Checks":[{"Id":"6.1","Desc":"避免镜像泛滥 (不计评分)","CheckId":"check_6_1"},{"Id":"6.2","Desc":"避免容器泛滥 (不计评分)","CheckId":"check_6_2"}]},{"Id":"7","Desc":"Docker 集群配置","Checks":[{"Id":"7.1","Desc":"必要时不启用群集模式 (计入评分)","CheckId":"check_7_1"},{"Id":"7.2","Desc":"在群集中最小数量创建管理器节点 (计入评分)","CheckId":"check_7_2"},{"Id":"7.3","Desc":"群集服务绑定到特定的主机接口 (计入评分)","CheckId":"check_7_3"},{"Id":"7.4","Desc":"数据在的不同节点上进行加密 (计入评分)","CheckId":"check_7_4"},{"Id":"7.5","Desc":"管理 Swarm 集群中的涉密信息 (不计评分)","CheckId":"check_7_5"},{"Id":"7.6","Desc":"swarm manager 在自动锁定模式下运行 (计入评分)","CheckId":"check_7_6"},{"Id":"7.7","Desc":"swarm manager 自动锁定秘钥周期性轮换 (不计评分)","CheckId":"check_7_7"},{"Id":"7.8","Desc":"节点证书适当轮换 (不计评分)","CheckId":"check_7_8"},{"Id":"7.9","Desc":"CA 根证书根据需要进行轮换 (不计评分)","CheckId":"check_7_9"},{"Id":"7.10","Desc":"管理平面流量分流自数据平面流量 (不计评分)","CheckId":"check_7_10"}]},{"Id":"8","Desc":"Docker 企业版配置","Checks":[{"Id":"8.1.1","Desc":"配置LDAP认证服务 (计入评分)","CheckId":"check_8_1_1"},{"Id":"8.1.2","Desc":"使用外部证书 (计入评分)","CheckId":"check_8_1_2"},{"Id":"8.1.3","Desc":"为没有授权的用户使用客户端证书包 (不计评分)","CheckId":"check_8_1_3"},{"Id":"8.1.4","Desc":"配备适用于集群的RBAC策略 (不计评分)","CheckId":"check_8_1_4"},{"Id":"8.1.5","Desc":"启用签名镜像增强 (计入评分)","CheckId":"check_8_1_5"},{"Id":"8.1.6","Desc":"设置每个用户的会话值为''3''或更低 (计入评分)","CheckId":"check_8_1_6"},{"Id":"8.1.7","Desc":"设置 ''Lifetime Minutes''值为15 , ''Renewal Threshold Minutes''值为0  (计入评分)","CheckId":"check_8_1_7"},{"Id":"8.2","Desc":"允许镜像漏洞扫描 (计入评分)","CheckId":"check_8_2"}]}]}', null, null, null, null, null, null, null, null, null, null, null, null, null); END IF; END $do$;`
	// template - KubeBench
	DefaultK8sBenchCis13Sql = `DO $do$ BEGIN IF NOT EXISTS (SELECT from system_template WHERE id='9b4320a4-57f5-4559-a91b-d84b0d0a0f01') THEN INSERT INTO public.system_template (id, account, name, description, type, version, commands, status, is_default, config_mode, default_targets, check_master_json, check_node_json, check_control_plane_json, check_etcd_json, check_policies_json, check_managed_services_json, check_ids_master, check_ids_node, check_ids_control_plane, check_ids_etcd, check_ids_policies, check_ids_managed_services, check_ids_docker, check_ids_docker_check) VALUES ('9b4320a4-57f5-4559-a91b-d84b0d0a0f01', 'admin', 'CIS标准-Kubernetes benchmark', '', 'KubernetesBenchMark', 'cis-1.3', 'docker run --rm --pid=host -v /etc:/etc:ro -v /var:/var:ro -t registry.cn-qingdao.aliyuncs.com/diss/kube-bench:v0.3.0', 'Enable', true, 'target', '{"master":true,"node":true}', '{"controls":null,"version":1.11,"id":1,"text":"Master Node 安全配置要求","type":"master","groups":[{"id":1.1,"text":"API服务器","checks":[{"id":"1.1.1","text":"确保将--anonymous-auth参数设置为false (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--anonymous-auth","compare":{"op":"eq","value":false},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf，设置以下参数 --anonymous-auth=false\n","scored":true},{"id":"1.1.2","text":"确保未设置--basic-auth-file参数 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--basic-auth-file","set":false}]},"remediation":"按照文档和配置备用机制进行身份验证。然后，在主节点上编辑API服务器Pod配置文件$apiserverconf ，删除 --basic-auth-file=<filename> 参数。\n","scored":true},{"id":"1.1.3","text":"确保未设置--insecure-allow-any-token参数 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--insecure-allow-any-token","set":false}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf，删除--insecure-allow-any-token参数。\n","scored":true},{"id":"1.1.4","text":"确保将--kubelet-https参数设置为true (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--kubelet-https","compare":{"op":"eq","value":true},"set":true},{"flag":"--kubelet-https","set":false}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf，删除 --kubelet-https 参数。\n","scored":true},{"id":"1.1.5","text":"确保未设置--insecure-bind-address参数 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--insecure-bind-address","set":false}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf，删除 --insecure-bind-address 参数。\n","scored":true},{"id":"1.1.6","text":"确保将--insecure-port参数设置为0 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--insecure-port","compare":{"op":"eq","value":0},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf，设置以下参数 --insecure-port=0\n","scored":true},{"id":"1.1.7","text":"确保将--secure-port参数未设置为0 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--secure-port","compare":{"op":"gt","value":0},"set":true},{"flag":"--secure-port","set":false}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf，删除 --secure-port 参数或将其设置为其他（非零）端口。\n","scored":true},{"id":"1.1.8","text":"确保将--profiling参数设置为false (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--profiling","compare":{"op":"eq","value":false},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf，设置以下参数 --profiling=false\n","scored":true},{"id":"1.1.9","text":"确保将--repair-malformed-updates参数设置为false (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--repair-malformed-updates","compare":{"op":"eq","value":false},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf，设置以下参数 --repair-malformed-updates=false\n","scored":true},{"id":"1.1.10","text":"确保未设置许可控制插件AlwaysAdmit (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--enable-admission-plugins","compare":{"op":"nothave","value":"AlwaysAdmit"},"set":true},{"flag":"--enable-admission-plugins","set":false}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf，将 --enable-admission-plugins 参数设置为不包含 AlwaysAdmit 的值。\n","scored":true},{"id":"1.1.11","text":"确保已设置许可控制插件AlwaysPullImages (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--enable-admission-plugins","compare":{"op":"has","value":"AlwaysPullImages"},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf ，将 --enable-admission-plugins 参数设置为包含 AlwaysPullImages 的值。例如: --enable-admission-plugins=...，AlwaysPullImages，...\n","scored":true},{"id":"1.1.12","text":"确保设置了许可控制插件DenyEscalatingExec (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--enable-admission-plugins","compare":{"op":"has","value":"DenyEscalatingExec"},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf ，将 --enable-admission-plugins 参数设置为包含 DenyEscalatingExec 的值。—enable-admission-plugins=...，DenyEscalatingExec，...\n","scored":true},{"id":"1.1.13","text":"确保已设置许可控制插件SecurityContextDeny (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--enable-admission-plugins","compare":{"op":"has","value":"SecurityContextDeny"},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf ，将 --enable-admission-plugins 参数设置为包含 SecurityContextDeny 的值。 --enable-admission-plugins=...，SecurityContextDeny，...\n","scored":true},{"id":"1.1.14","text":"确保设置了许可控制插件NamespaceLifecycle (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--disable-admission-plugins","compare":{"op":"nothave","value":"NamespaceLifecycle"},"set":true},{"flag":"--disable-admission-plugins","set":false}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf ，设置 --disable-admission-plugins 参数以确保它不包含 NamespaceLifecycle。\n","scored":true},{"id":"1.1.15","text":"确保--audit-log-path参数已设置为适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--audit-log-path","set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf ，将 --audit-log-path 参数设置为您希望审核日志的合适路径和文件例如:--audit-log-path=/var/log/apiserver/audit.log\n","scored":true},{"id":"1.1.16","text":"确保--audit-log-maxage参数设置为30或适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--audit-log-maxage","compare":{"op":"gte","value":30},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf ，将--audit-log-maxage 参数设置为30或适当的天数: --audit-log-maxage=30\n","scored":true},{"id":"1.1.17","text":"确保--audit-log-maxbackup参数设置为10或适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--audit-log-maxbackup","compare":{"op":"gte","value":10},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf ，将--audit-log-maxbackup 参数设置为10或适当的值。--audit-log-maxbackup=10\n","scored":true},{"id":"1.1.18","text":"确保--audit-log-maxsize参数设置为100或适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--audit-log-maxsize","compare":{"op":"gte","value":100},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf ，将 --audit-log-maxsize 参数设置为适当的大小（MB）。例如，要将其设置为100 MB:--audit-log-maxsize=100\n","scored":true},{"id":"1.1.19","text":"确保--authorization-mode参数未设置为AlwaysAllow (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--authorization-mode","compare":{"op":"nothave","value":"AlwaysAllow"},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf ，将--authorization-mode设置为AlwaysAllow参数以外的值。例如: --authorization-mode=Node, RBAC\n","scored":true},{"id":"1.1.20","text":"确保未设置--token-auth-file参数 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--token-auth-file","set":false}]},"remediation":"Follow the documentation and configure alternate mechanisms for authentication. Then,\nedit the API server pod specification file $apiserverconf\non the master node and remove the --token-auth-file=<filename>\nparameter.\n","scored":true},{"id":"1.1.21","text":"确保--kubelet-certificate-authority参数设置为适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--kubelet-certificate-authority","set":true}]},"remediation":"按照Kubernetes文档设置apiserver和kubelet之间的TLS连接。然后，在主节点上编辑API服务器Pod配置文件$apiserverconf ,将 --kubelet-certificate-authority 参数设置为证书颁发机构的cert文件的路径。 --kubelet-certificate-authority=<ca-string>\n","scored":true},{"id":"1.1.22","text":"确保--kubelet-client-certificate和--kubelet-client- key参数设置为适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"and","test_items":[{"flag":"--kubelet-client-certificate","set":true},{"flag":"--kubelet-client-key","set":true}]},"remediation":"按照Kubernetes文档设置apiserver和kubelet之间的TLS连接。然后，在主节点上编辑API服务器Pod配置文件$apiserverconf ,设置kubelet客户端证书和关键参数，如下所示 --kubelet-client-certificate=<path/to/client-certificate-file> --kubelet-client-key=<path/to/client-key-file>\n","scored":true},{"id":"1.1.23","text":"确保--service-account-lookup参数设置为true (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--service-account-lookup","compare":{"op":"eq","value":true},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf，设置以下参数 --service-account-lookup=true\n","scored":true},{"id":"1.1.24","text":"确保已设置许可控制插件PodSecurityPolicy (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--enable-admission-plugins","compare":{"op":"has","value":"PodSecurityPolicy"},"set":true}]},"remediation":"按照文档根据您的环境创建Pod安全策略对象。然后，在主节点上编辑API服务器Pod配置文件$apiserverconf ，将 --enable-admission-plugins 参数设置为包含PodSecurityPolicyenable的值: --admission-plugins=...，PodSecurityPolicy，... 然后重新启动API服务器。\n","scored":true},{"id":"1.1.25","text":"确保--service-account-key-file参数设置为适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--service-account-key-file","set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf ，将--service-account-key-file参数设置为服务帐户的公钥文件：--service-account-key文件=<文件名>\n","scored":true},{"id":"1.1.26","text":"确保--etcd-certfile和--etcd-keyfile参数设置为适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"and","test_items":[{"flag":"--etcd-certfile","set":true},{"flag":"--etcd-keyfile","set":true}]},"remediation":"按照Kubernetes文档在apiserver和etcd之间设置TLS连接。然后，在主节点上编辑API服务器Pod配置文件$apiserverconf ，设置etcd证书和密钥文件参数。--etcd-certfile=<path/to/client-certificate-file> --etcd-keyfile=<path/to/client-key-file>\n","scored":true},{"id":"1.1.27","text":"确保设置了许可控制插件ServiceAccount (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--enable-admission-plugins","compare":{"op":"has","value":"ServiceAccount"},"set":true},{"flag":"--enable-admission-plugins","set":false}]},"remediation":"按照文档根据您的环境创建ServiceAccount对象。 然后，在主节点上编辑API服务器Pod配置文件$apiserverconf ，确保将--disable-admission-plugins参数设置为不包含ServiceAccount的值。\n","scored":true},{"id":"1.1.28","text":"确保根据需要设置--tls-cert-file和--tls-private-key-file参数 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"and","test_items":[{"flag":"--tls-cert-file","set":true},{"flag":"--tls-private-key-file","set":true}]},"remediation":"按照Kubernetes文档在apiserver上设置TLS连接。然后，在主节点上编辑API服务器Pod配置文件$apiserverconf ，设置TLS证书和私钥文件参数。 --tls-cert-file=<path/to/tls-certificate-file> --tls-private-key-file=<path/to/tls-key-file>\n","scored":true},{"id":"1.1.29","text":"确保将--client-ca-file参数设置为适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--client-ca-file","set":true}]},"remediation":"按照Kubernetes文档在apiserver上设置TLS连接。然后，在主节点上编辑API服务器Pod配置文件$apiserverconf ，设置客户端证书颁发机构文件。 --client-ca-file=<path/to/client-ca-file>\n","scored":true},{"id":"1.1.30","text":"确保API服务器仅使用强加密密码 (不计分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--tls-cipher-suites","compare":{"op":"has","value":"TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256"},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf 设置以下参数 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM _SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM _SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM _SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256\n","scored":false},{"id":"1.1.31","text":"确保--etcd-cafile参数设置为适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--etcd-cafile","set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf ，将--authorization-mode参数设置为包含Node的值。--authorization-mode=Node,RBAC\n","scored":true},{"id":"1.1.32","text":"确保--authorization-mode参数包含Node (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--authorization-mode","compare":{"op":"has","value":"Node"},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf ，将--authorization-mode参数设置为包含Node的值。--authorization-mode=Node,RBAC\n","scored":true},{"id":"1.1.33","text":"确保设置了许可控制插件NodeRestriction (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--enable-admission-plugins","compare":{"op":"has","value":"NodeRestriction"},"set":true}]},"remediation":"按照Kubernetes文档在kubelet上配置 NodeRestriction 插件。然后，在主节点上编辑API服务器Pod配置文件$apiserverconf ，将 --enable-admission-plugins 参数设置为包含 NodeRestriction 的值。 --enable-admission-plugins=...，NodeRestriction，...\n","scored":true},{"id":"1.1.34","text":"确保--experimental-encryption-provider-config参数设置为适当 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--experimental-encryption-provider-config","set":true}]},"remediation":"按照Kubernetes文档配置 EncryptionConfig 文件。然后，在主节点上编辑API服务器Pod配置文件$apiserverconf ，将 --experimental-encryption-provider-config 参数设置为该文件的路径:--experimental-encryption -provider-config=</path/to/EncryptionConfig/File>\n","scored":true},{"id":"1.1.35","text":"确保将加密提供程序设置为aescbc (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","type":"manual","remediation":"[手动测试]\n按照Kubernetes文档配置 EncryptionConfig 文件。在此文件中，选择 aescbc 作为加密提供程序。例如：\nkind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n    - secrets\n      providers:\n      - aescbc:\n          keys:\n          - name: key1\n            secret: <32-byte base64-encoded secret>\n","scored":true},{"id":"1.1.36","text":"确保设置了许可控制插件EventRateLimit (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--enable-admission-plugins","compare":{"op":"has","value":"EventRateLimit"},"set":true}]},"remediation":"按照Kubernetes文档在配置文件中设置所需的限制。然后，在主节点上编辑API服务器Pod配置文件$apiserverconf , 设置以下参数\n--enable-admission-plugins=...,EventRateLimit,...\n--admission-control-config-file=<path/to/configuration/file>\n","scored":true},{"id":"1.1.37a","text":"确保AdvancedAuditing参数未设置为false (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--feature-gates","compare":{"op":"nothave","value":"AdvancedAuditing=false"},"set":true},{"flag":"--feature-gates","set":false}]},"remediation":"按照Kubernetes文档在$apiserverconf 文件中设置所需的审核策略。然后，在主节点上编辑API服务器Pod配置文件$apiserverconf ,设置以下参数\n--audit-policy-file=/etc/kubernetes/audit-policy.yaml\n","scored":true},{"id":"1.1.37b","text":"确保AdvancedAuditing参数未设置为false (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--audit-policy-file","compare":{"op":"eq","value":"/etc/kubernetes/audit-policy.yaml"},"set":true},{"flag":"--audit-policy-file","compare":{"op":"eq","value":"/etc/kubernetes/audit-policy.yml"},"set":true}]},"remediation":"按照Kubernetes文档在$apiserverconf 文件中设置所需的审核策略。然后，在主节点上编辑API服务器Pod配置文件$apiserverconf ,设置以下参数\n--audit-policy-file=/etc/kubernetes/audit-policy.yaml\n","scored":true},{"id":"1.1.38","text":"确保--request-timeout参数设置为适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--request-timeout","set":false},{"flag":"--request-timeout","set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf  根据需要设置以下参数 例如:\n--request-timeout=300s\n","scored":true},{"id":"1.1.39","text":"确保API服务器仅使用强加密密码 ( Not Scored)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--tls-cipher-suites","compare":{"op":"eq","value":"TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256"},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf 将--authorization-mode参数设置为包含RBAC的值，例如：\n--tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256\n","scored":false}]},{"id":1.2,"text":"调度程序","checks":[{"id":"1.2.1","text":"确保将--profiling参数设置为false (计入分数)","audit":"/bin/ps -ef | grep $schedulerbin | grep -v grep","tests":{"test_items":[{"flag":"--profiling","compare":{"op":"eq","value":false},"set":true}]},"remediation":"编辑主节点上的Scheduler Pod配置文件$schedulerconf文件，设置以下参数\n --profiling=false\n","scored":true},{"id":"1.2.2","text":"确保--address参数设置为 127.0.0.1 (计入分数)","audit":"/bin/ps -ef | grep $schedulerbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--address","compare":{"op":"eq","value":"127.0.0.1"},"set":true},{"flag":"--address","set":false}]},"remediation":"编辑调度程序Pod配置文件$schedulerconf 确保--address参数的值是正确的\n","scored":true}]},{"id":1.3,"text":"控制器管理","checks":[{"id":"1.3.1","text":"确保将--terminated-pod-gc-threshold参数设置合适 (计入分数)","audit":"/bin/ps -ef | grep $controllermanagerbin | grep -v grep","tests":{"test_items":[{"flag":"--terminated-pod-gc-threshold","set":true}]},"remediation":"在主节点上编辑Controller Manager Pod配置文件$controllermanagerconf ，将 --terminated-pod-gc-threshold 设置为适当的阈值，例如:\n--terminated-pod-gc-threshold=10\n","scored":true},{"id":"1.3.2","text":"确保将--profiling参数设置为false (计入分数)","audit":"/bin/ps -ef | grep $controllermanagerbin | grep -v grep","tests":{"test_items":[{"flag":"--profiling","compare":{"op":"eq","value":false},"set":true}]},"remediation":"在主节点上编辑Controller Manager Pod配置$controllermanagerconf ，设置以下参数\n--profiling=false\n","scored":true},{"id":"1.3.3","text":"确保将--use-service-account-credentials参数设置为true (计入分数)","audit":"/bin/ps -ef | grep $controllermanagerbin | grep -v grep","tests":{"test_items":[{"flag":"--use-service-account-credentials","compare":{"op":"noteq","value":false},"set":true}]},"remediation":"编辑Controller Manager Pod配置文件$controllermanagerconf 在主节点上，设置以下参数\n--use-service-account-credentials=true\n","scored":true},{"id":"1.3.4","text":"确保将--service-account-private-key-file参数设置为适当的值 (计入分数)","audit":"/bin/ps -ef | grep $controllermanagerbin | grep -v grep","tests":{"test_items":[{"flag":"--service-account-private-key-file","set":true}]},"remediation":"在主节点上编辑Controller Manager Pod配置文件$controllermanagerconf ，将 --service-account-private-key-file 参数设置为服务帐户的私钥文件\n--service-account-private-key-file=<filename>\n","scored":true},{"id":"1.3.5","text":"确保正确设置--root-ca-file参数 (计入分数)","audit":"/bin/ps -ef | grep $controllermanagerbin | grep -v grep","tests":{"test_items":[{"flag":"--root-ca-file","set":true}]},"remediation":"在主节点上编辑Controller Manager Pod配置文件$controllermanagerconf ，将 --root-ca-file文件 参数设置为证书捆绑。\n--root-ca-file=<path/to/file>\n","scored":true},{"id":"1.3.6","text":"确保将RotateKubeletServerCertificate参数设置为true (计入分数)","audit":"/bin/ps -ef | grep $controllermanagerbin | grep -v grep","tests":{"test_items":[{"flag":"--feature-gates","compare":{"op":"eq","value":"RotateKubeletServerCertificate=true"},"set":true}]},"remediation":"在主节点上编辑Controller Manager Pod配置文件$controllermanagerconf ，将 --feature-gates 参数设置为包含 RotateKubeletServerCertificate=true。\n--feature-gates=RotateKubeletServerCertificate=true\n","scored":true},{"id":"1.3.7","text":"确保--address参数设置为 127.0.0.1 (计入分数)","audit":"/bin/ps -ef | grep $controllermanagerbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--address","compare":{"op":"eq","value":"127.0.0.1"},"set":true},{"flag":"--address","set":false}]},"remediation":"在主节点上编辑Controller Manager Pod配置文件$controllermanagerconf ，确保 --address 参数的值正确\n","scored":true}]},{"id":1.4,"text":"配置文件","checks":[{"id":"1.4.1","text":"确保将API server Pod配置文件权限设置为644或更严格","audit":"/bin/sh -c ''if test -e $apiserverconf; then stat -c permissions=%a $apiserverconf; fi''","tests":{"test_items":[{"flag":"permissions","compare":{"op":"bitmask","value":"644"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchmod 644 $apiserverconf\n","scored":true},{"id":"1.4.2","text":"确保将API server pod配置文件所有权设置为root:root (计入分数)","audit":"/bin/sh -c ''if test -e $apiserverconf; then stat -c %U:%G $apiserverconf; fi''","tests":{"test_items":[{"flag":"root:root","compare":{"op":"eq","value":"root:root"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchown root:root $apiserverconf\n","scored":true},{"id":"1.4.3","text":"确保将controller manager配置文件权限设置为644或更严格 (计入分数)","audit":"/bin/sh -c ''if test -e $controllermanagerconf; then stat -c permissions=%a $controllermanagerconf; fi''","tests":{"test_items":[{"flag":"permissions","compare":{"op":"bitmask","value":"644"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchmod 644 $controllermanagerconf\n","scored":true},{"id":"1.4.4","text":"确保将controller manager配置文件所有权设置为root:root (计入分数)","audit":"/bin/sh -c ''if test -e $controllermanagerconf; then stat -c %U:%G $controllermanagerconf; fi''","tests":{"test_items":[{"flag":"root:root","compare":{"op":"eq","value":"root:root"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchown root:root $controllermanagerconf\n","scored":true},{"id":"1.4.5","text":"确保将scheduler pod配置文件权限设置为644或更严格 (计入分数)","audit":"/bin/sh -c ''if test -e $schedulerconf; then stat -c permissions=%a $schedulerconf; fi''","tests":{"test_items":[{"flag":"permissions","compare":{"op":"bitmask","value":"644"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchmod 644 $schedulerconf\n","scored":true},{"id":"1.4.6","text":"确保将scheduler pod 配置文件所有权设置为root:root (计入分数)","audit":"/bin/sh -c ''if test -e $schedulerconf; then stat -c %U:%G $schedulerconf; fi''","tests":{"test_items":[{"flag":"root:root","compare":{"op":"eq","value":"root:root"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchown root:root $schedulerconf\n","scored":true},{"id":"1.4.7","text":"确保将etcd pod配置文件权限设置为644或更严格 (计入分数)","audit":"/bin/sh -c ''if test -e $etcdconf; then stat -c permissions=%a $etcdconf; fi''","tests":{"test_items":[{"flag":"permissions","compare":{"op":"bitmask","value":"644"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchmod 644 $etcdconf\n","scored":true},{"id":"1.4.8","text":"确保将etcd pod 配置文件所有权设置为 root:root(计入分数)","audit":"/bin/sh -c ''if test -e $etcdconf; then stat -c %U:%G $etcdconf; fi''","tests":{"test_items":[{"flag":"root:root","compare":{"op":"eq","value":"root:root"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchown root:root $etcdconf\n","scored":true},{"id":"1.4.9","text":"确保将Container Network Interface文件权限设置为644或更严格 (不计分数)","audit":"stat -c permissions=%a <path/to/cni/files>","type":"manual","remediation":"[手动测试]\n在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchmod 644 <path/to/cni/files>\n","scored":true},{"id":"1.4.10","text":"确保将Container Network Interfac文件所有权设置为root:root (Not Scored)","audit":"stat -c %U:%G <path/to/cni/files>","type":"manual","remediation":"[手动测试]\n在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchown root:root <path/to/cni/files>\n","scored":true},{"id":"1.4.11","text":"确保将etcd data文件夹权限设置为700或更严格 (计入分数)","audit":"ps -ef | grep $etcdbin | grep -- --data-dir | sed ''s%.*data-dir[= ]\\([^ ]*\\).*%\\1%'' | xargs stat -c permissions=%a","tests":{"test_items":[{"flag":"permissions","compare":{"op":"bitmask","value":"700"},"set":true}]},"remediation":"在etcd服务器节点上获取etcd数据目录，作为参数传递 --data-dir，从以下命令:\nps -ef | grep $etcdbin\n运行以下命令（基于上面找到的etcd数据目录）。例如，\nchmod 700 /var/lib/etcd\n","scored":true},{"id":"1.4.12","text":"确保将etcd data文件夹所有权设置为etcd:etcd (计入分数)","audit":"ps -ef | grep $etcdbin | grep -- --data-dir | sed ''s%.*data-dir[= ]\\([^ ]*\\).*%\\1%'' | xargs stat -c %U:%G","tests":{"test_items":[{"flag":"etcd:etcd","set":true}]},"remediation":"在etcd服务器节点上获取etcd数据目录，作为参数传递 --data-dir，从以下命令:\nps -ef | grep $etcdbin\n运行以下命令（基于上面找到的etcd数据目录）。例如，\nchown etcd:etcd /var/lib/etcd\n","scored":true},{"id":"1.4.13","text":"确保将admin.conf权限设置为644或更严格 (计入分数)","audit":"/bin/sh -c ''if test -e /etc/kubernetes/admin.conf; then stat -c permissions=%a /etc/kubernetes/admin.conf; fi''","tests":{"test_items":[{"flag":"permissions","compare":{"op":"bitmask","value":"644"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchmod 644 /etc/kubernetes/admin.conf\n","scored":true},{"id":"1.4.14","text":"确保将admin.conf文件所有权设置为root:root (计入分数)","audit":"/bin/sh -c ''if test -e /etc/kubernetes/admin.conf; then stat -c %U:%G /etc/kubernetes/admin.conf; fi''","tests":{"test_items":[{"flag":"root:root","compare":{"op":"eq","value":"root:root"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchown root:root /etc/kubernetes/admin.conf\n","scored":true},{"id":"1.4.15","text":"确保将scheduler.conf权限设置为644或更严格 (计入分数)","audit":"/bin/sh -c ''if test -e /etc/kubernetes/scheduler.conf; then stat -c permissions=%a /etc/kubernetes/scheduler.conf; fi''","tests":{"test_items":[{"flag":"permissions","compare":{"op":"bitmask","value":"644"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如， chmod 644 /etc/kubernetes/scheduler.conf\n","scored":true},{"id":"1.4.16","text":"确保将scheduler.conf文件所有权设置为root:root (计入分数)","audit":"/bin/sh -c ''if test -e /etc/kubernetes/scheduler.conf; then stat -c %U:%G /etc/kubernetes/scheduler.conf; fi''","tests":{"test_items":[{"flag":"root:root","compare":{"op":"eq","value":"root:root"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如， chown root:root /etc/kubernetes/scheduler.conf\n","scored":true},{"id":"1.4.17","text":"确保将controller-manager.conf 权限设置为644或更严格 (计入分数)","audit":"/bin/sh -c ''if test -e /etc/kubernetes/controller-manager.conf; then stat -c permissions=%a /etc/kubernetes/controller-manager.conf; fi''","tests":{"test_items":[{"flag":"permissions","compare":{"op":"bitmask","value":"644"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如， chmod 644 /etc/kubernetes/controller-manager.conf\n","scored":true},{"id":"1.4.18","text":"确保将controller-manager.conf文件所有权设置为root:root (计入分数)","audit":"/bin/sh -c ''if test -e /etc/kubernetes/controller-manager.conf; then stat -c %U:%G /etc/kubernetes/controller-manager.conf; fi''","tests":{"test_items":[{"flag":"root:root","compare":{"op":"eq","value":"root:root"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如， chown root:root /etc/kubernetes/controller-manager.conf\n","scored":true}]},{"id":1.5,"text":"etcd配置","checks":[{"id":"1.5.1","text":"确保将--cert-file和--key-file参数设置为适当的值 (计入分数)","audit":"/bin/ps -ef | grep $etcdbin | grep -v grep","tests":{"test_items":[{"flag":"--cert-file","set":true},{"flag":"--key-file","set":true}]},"remediation":"按照etcd服务文档配置TLS加密。然后，在主节点上编辑etcd Pod配置文件$etcdconf l，设置以下参数 --cert-file=</path/to/ca-file> --key-file=</path/to/key-file>\n--ca-file=</path/to/ca-file>\n--key-file=</path/to/key-file>\n","scored":true},{"id":"1.5.2","text":"确保将--client-cert-auth参数设置为true (计入分数)","audit":"/bin/ps -ef | grep $etcdbin | grep -v grep","tests":{"test_items":[{"flag":"--client-cert-auth","compare":{"op":"noteq","value":false},"set":true}]},"remediation":"在主节点上编辑etcd Pod配置文件$etcdconf ，设置以下参数\n--client-cert-auth=\"true\"\n","scored":true},{"id":"1.5.3","text":"确保--auto-tls参数未设置为true (计入分数)","audit":"/bin/ps -ef | grep $etcdbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--auto-tls","set":false},{"flag":"--auto-tls","compare":{"op":"eq","value":false}}]},"remediation":"在主节点上编辑etcd Pod配置文件$etcdconf ，删除 --auto-tls 参数或将其设置为 false。\n  --auto-tls=false\n","scored":true},{"id":"1.5.4","text":"确保正确设置--peer-cert-file和--peer-key-file参数 (计入分数)","audit":"/bin/ps -ef | grep $etcdbin | grep -v grep","tests":{"bin_op":"and","test_items":[{"flag":"--peer-cert-file","set":true},{"flag":"--peer-key-file","set":true}]},"remediation":"按照etcd服务文档根据您的etcd群集配置对等TLS加密。然后，在主节点上编辑etcd Pod配置文件$etcdconf ，设置以下参数\n--peer-client-file=</path/to/peer-cert-file>\n--peer-key-file=</path/to/peer-key-file>\n","scored":true},{"id":"1.5.5","text":"确保将--peer-client-cert-auth参数设置为true (计入分数)","audit":"/bin/ps -ef | grep $etcdbin | grep -v grep","tests":{"test_items":[{"flag":"--peer-client-cert-auth","compare":{"op":"eq","value":true},"set":true}]},"remediation":"在主节点上编辑etcd Pod配置文件$etcdconf ，设置以下参数\n--peer-client-cert-auth=true\n","scored":true},{"id":"1.5.6","text":"确保--peer-auto-tls参数未设置为true (计入分数)","audit":"/bin/ps -ef | grep $etcdbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--peer-auto-tls","set":false},{"flag":"--peer-auto-tls","compare":{"op":"eq","value":false},"set":true}]},"remediation":"在主节点上编辑etcd Pod配置文件$etcdconf ，删除 --peer-auto-tls 参数或将其设置为 false。\n--peer-auto-tls=false\n","scored":true},{"id":"1.5.7","text":"确保将唯一的证书颁发机构用于etcd (Not Scored)","audit":"/bin/ps -ef | grep $etcdbin | grep -v grep","type":"manual","tests":{"test_items":[{"flag":"--trusted-ca-file","set":true}]},"remediation":"[手动测试]\n按照etcd文档为etcd服务创建专用的证书颁发机构设置。 然后，在主节点上编辑etcd Pod配置文件$etcdconf ，设置以下参数\n--trusted-ca-file=</path/to/ca-file>\n","scored":false}]},{"id":1.6,"text":"基本安全设置","checks":[{"id":"1.6.1","text":"确保仅在需要时使用集群管理员角色 (Not Scored)","type":"manual","remediation":"[手动测试]\n移除所有不必要的clusterrolebinding :\nkubectl delete clusterrolebinding [name]\n","scored":false},{"id":"1.6.2","text":"使用命名空间在资源之间创建管理边界 (Not Scored)","type":"manual","remediation":"[手动测试]\n按照文档的说明，根据需要为部署中的对象创建名称空间。\n","scored":false},{"id":"1.6.3","text":"使用网络策略创建网络分段 (Not Scored)","type":"manual","remediation":"[手动测试]\n按照文档根据需要创建NetworkPolicy对象。\n","scored":false},{"id":"1.6.4","text":"确保在pod定义中将seccomp配置文件设置为docker/default (Not Scored)","type":"manual","remediation":"[手动测试]\nSeccomp目前是一个alpha功能。 默认情况下，禁用所有Alpha功能。 因此，您需要通过传递\"--featuregates=AllAlpha=true\"参数来启用apiserver中的alpha功能。\n编辑主节点上的/etc/kubernetes/apiserver文件，将KUBE_API_ARGS参数设置为\"--feature-gates=AllAlpha=true\"\nKUBE_API_ARGS=\"--feature-gates=AllAlpha=true\"\n根据您的系统，重新启动kube-apiserver服务。 例如：\nsystemctl restart kube-apiserver.service\n使用注释在pod定义中启用docker/default seccomp配置文件。 一个例子如下：\napiVersion: v1\nkind: Pod\nmetadata:\n  name: trustworthy-pod\n  annotations:\n    seccomp.security.alpha.kubernetes.io/pod: docker/default\nspec:\n  containers:\n    - name: trustworthy-container\n      image: sotrustworthy:latest\n","scored":false},{"id":"1.6.5","text":"将Security Context应用于您的Pod和容器 (Not Scored)","type":"manual","remediation":"[手动测试]\n按照Kubernetes文档将Security Context应用到您的pod。 有关Security Context的建议列表，您可以参考Docker容器的CIS安全基准。\n","scored":false},{"id":"1.6.6","text":"使用ImagePolicyWebhook许可控制器配置Image Provenance (Not Scored)","type":"manual","remediation":"[手动测试]\n按照Kubernetes文档设置Image Provenance。\n","scored":false},{"id":"1.6.7","text":"根据需要配置网络策略 (Not Scored)","type":"manual","remediation":"[手动测试]\n按照Kubernetes文档根据需要设置网络策略。 例如，您可以通过创建NetworkPolicy为名称空间创建“默认”隔离策略，该策略选择所有Pod但不允许任何流量：\napiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: default-deny\nspec:\n  podSelector:\n","scored":false},{"id":"1.6.8","text":"以PSP和RBAC的形式为特权容器设置限制 (Not Scored)","type":"manual","remediation":"[手动测试]\n按照Kubernetes文档为您的集群设置PSP和RBAC授权。\n","scored":false}]},{"id":1.7,"text":"POD安全策略","checks":[{"id":"1.7.1","text":"不接受特权容器 (Not Scored)","type":"manual","remediation":"[手动测试]\n按照Kubernetes文档中的描述创建PSP，确保省略 .spec.privileged 字段或将其设置为false。\n","scored":false},{"id":"1.7.2","text":"不接受共享主机PID命名空间容器 (计入分数)","type":"manual","remediation":"[手动测试]\n按照Kubernetes文档中的描述创建PSP，确保省略 .spec.hostPID 字段或将其设置为false。\n","scored":false},{"id":"1.7.3","text":"不接受共享主机IPC命名空间容器 (计入分数)","type":"manual","remediation":"[手动测试]\n按照Kubernetes文档中的描述创建PSP，确保省略 .spec.hostIPC 字段或将其设置为false。\n","scored":false},{"id":"1.7.4","text":"不接受共享主机network命名空间容器 (计入分数)","type":"manual","remediation":"[手动测试]\n按照Kubernetes文档中的描述创建PSP，确保省略 .spec.hostNetwork 字段或将其设置为false。\n","scored":false},{"id":"1.7.5","text":"不接受allowPrivilegeEscalation容器 (计入分数)","type":"manual","remediation":"[手动测试]\n按照Kubernetes文档中的描述创建PSP，确保省略 .spec.allowPrivilegeEscalation 字段或将其设置为false。\n","scored":false},{"id":"1.7.6","text":"不接受root用户运行的容器 (Not Scored)","type":"manual","remediation":"[手动测试]\n按照Kubernetes文档中的描述创建PSP，确保 .spec.runAsUser.rule 设置为 MustRunAsNonRoot 或 MustRunAs 且 UID 不能为 0.\n","scored":false},{"id":"1.7.7","text":"不接受requiredDropCapabilities的容器 (Not Scored)","type":"manual","remediation":"[手动测试]\n按照Kubernetes文档中的描述创建PSP，确保将 .spec.requiredDropCapabilities 设置为包含 NET_RAW 或 ALL。\n","scored":false}]}]}', '{"controls":null,"version":"1.11","id":"2","text":"Worker Node 安全配置要求","type":"node","groups":[{"id":"2.1","text":"Kubelet","checks":[{"id":"2.1.1","text":"确保--allow-privilegedt参数设置为false (计入分数)","audit":"/bin/ps -fC $kubeletbin ","tests":{"test_items":[{"flag":"--allow-privileged","set":true,"compare":{"op":"eq","value":false}}]},"remediation":"Edit the kubelet service file $kubeletsvc\non each worker node and set the below parameter in KUBELET_SYSTEM_PODS_ARGS variable.\n--allow-privileged=false\nBased on your system, restart the kubelet service. For example:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"2.1.2","text":"确保将--anonymous-auth参数设置为false (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--anonymous-auth","path":"{.authentication.anonymous.enabled}","set":true,"compare":{"op":"eq","value":false}}]},"remediation":"如果使用Kubelet配置文件，请编辑该文件设置 authentication: anonymous: enabled 为 false。如果使用命令行参数，请在每个工作节点上编辑kubelet服务文件$kubeletsvc ，在 KUBELET_SYSTEM_PODS_ARGS 变量中设置以下参数 --anonymous-auth=false 根据您的系统，重新启动 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"2.1.3","text":"确保--authorization-mode参数未设置为AlwaysAllow (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--authorization-mode","path":"{.authorization.mode}","set":true,"compare":{"op":"nothave","value":"AlwaysAllow"}}]},"remediation":"如果使用Kubelet配置文件，请编辑该文件设置 authorization:mode 为 Webhook。如果使用命令行参数，请在每个工作节点上编辑kubelet服务文件$kubeletsvc ，在 KUBELET_AUTHZ_ARGS 变量中设置以下参数 --authorization-mode=Webhook 根据您的系统，重启 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"2.1.4","text":"确保将--client-ca-file参数设置为适当的值 (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--client-ca-file","path":"{.authentication.x509.clientCAFile}","set":true}]},"remediation":"如果使用Kubelet配置文件，请编辑该文件设置 authentication: x509: clientCAFile 为客户端CA文件的位置。如果使用命令行参数，请在每个工作节点上编辑kubelet服务文件$kubeletsvc ，在 KUBELET_AUTHZ_ARGS 变量中设置以下参数 --client-ca-file=<path/to/client-ca-file> 根据您的系统，重新启动 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"2.1.5","text":"确保将--read-only-port参数设置为0 (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--read-only-port","path":"{.readOnlyPort}","set":true,"compare":{"op":"eq","value":0}}]},"remediation":"如果使用Kubelet配置文件，请编辑该文件设置 readOnlyPort 为 0。如果使用命令行参数，请在每个工作节点上编辑kubelet服务文件$kubeletsvc ，在 KUBELET_SYSTEM_PODS_ARGS 变量中设置以下参数 --read-only-port=0 根据您的系统，重新启动 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"2.1.6","text":"确保--streaming-connection-idle-timeout参数未设置为0 (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--streaming-connection-idle-timeout","path":"{.streamingConnectionIdleTimeout}","set":true,"compare":{"op":"noteq","value":0}},{"flag":"--streaming-connection-idle-timeout","path":"{.streamingConnectionIdleTimeout}","set":false}],"bin_op":"or"},"remediation":"如果使用Kubelet配置文件，请编辑该文件设置 streamingConnectionIdleTimeout 为除0以外的值.如果使用命令行参数，请在每个工作节点上编辑kubelet服务文件$kubeletsvc ，在 KUBELET_SYSTEM_PODS_ARGS 变量中设置以下参数 --streaming-connection-idle-timeout=5m 根据您的系统，重启 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"2.1.7","text":"确保--protect-kernel-defaults参数设置为true (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--protect-kernel-defaults","path":"{.protectKernelDefaults}","set":true,"compare":{"op":"eq","value":true}}]},"remediation":"如果使用Kubelet配置文件，请编辑该文件设置 protectKernelDefaults: true。如果使用命令行参数，请在每个工作节点上编辑kubelet服务文件$kubeletsvc ，在 KUBELET_SYSTEM_PODS_ARGS 变量中设置以下参数 --protect-kernel-defaults=true 根据您的系统，重新启动 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"2.1.8","text":"确保--make-iptables-util-chains参数设置为true (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--make-iptables-util-chains","path":"{.makeIPTablesUtilChains}","set":true,"compare":{"op":"eq","value":true}},{"flag":"--make-iptables-util-chains","path":"{.makeIPTablesUtilChains}","set":false}],"bin_op":"or"},"remediation":"如果使用Kubelet配置文件，请编辑该文件设置 makeIPTablesUtilChains: true。如果使用命令行参数，请在每个工作节点上编辑kubelet服务文件$kubeletsvc ，从 KUBELET_CERTIFICATE_ARGS 变量中删除 --make-iptables-util-chains。 根据您的系统，重新启动 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"2.1.9","text":"确保未设置--hostname-override参数 (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--hostname-override","path":"{.hostnameOverride}","set":false}]},"remediation":"编辑kubelet服务文件$kubeletsvc 在每个工作节点上，从 KUBELET_CERTIFICATE_ARGS 变量中删除 —hostname-override。 根据您的系统，重新启动 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"2.1.10","text":"确保将--event-qps参数设置为0 (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--event-qps","path":"{.eventRecordQPS}","set":true,"compare":{"op":"eq","value":0}}]},"remediation":"如果使用Kubelet配置文件，请编辑该文件设置 eventRecordQPS:0。如果使用命令行参数，请在每个工作节点上编辑kubelet服务文件$kubeletsvc ，在 KUBELET_SYSTEM_PODS_ARGS 变量中设置以下参数 --event-qps=0 根据您的系统，重新启动 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"2.1.11","text":"确保正确设置--tls-cert-file和--tls-private-key-file参数 (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--tls-cert-file","path":"{.tlsCertFile}","set":true},{"flag":"--tls-private-key-file","path":"{.tlsPrivateKeyFile}","set":true}],"bin_op":"and"},"remediation":"如果使用Kubelet配置文件，请编辑该文件将tlsCertFile设置为用于标识此Kubelet的证书文件的位置，将tlsPrivateKeyFile设置为相应私钥文件的位置。如果使用命令行参数，请在每个工作节点上编辑kubelet服务文件$kubeletsvc ，在KUBELET_CERTIFICATE_ARGS变量中设置以下参数 --tls-cert-file=<path/to/tls-certificate-file> --tls-private-key-file=<path/to/tls-key-file> 根据您的系统，重新启动 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"2.1.12","text":"确保--cadvisor-port参数设置为0 (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--cadvisor-port","path":"{.cadvisorPort}","set":true,"compare":{"op":"eq","value":0}},{"flag":"--cadvisor-port","path":"{.cadvisorPort}","set":false}],"bin_op":"or"},"remediation":"编辑kubelet服务文件$kubeletsvc 在每个工作节点上，在 KUBELET_CADVISOR_ARGS 变量中设置以下参数 --cadvisor-port=0 根据您的系统，重新启动 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"2.1.13","text":"确保--rotate-certificates参数未设置为false (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--rotate-certificates","path":"{.rotateCertificates}","set":true,"compare":{"op":"eq","value":true}},{"flag":"--rotate-certificates","path":"{.rotateCertificates}","set":false}],"bin_op":"or"},"remediation":"如果使用Kubelet配置文件，请编辑该文件以添加行 rotateCertificates:true。如果使用命令行参数，请在每个工作节点上编辑kubelet服务文件$kubeletsvc ，将 --rotate-certificates=true 参数添加到 KUBELET_CERTIFICATE_ARGS 变量中。 根据您的系统，重新启动 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"2.1.14","text":"确保将RotateKubeletServerCertificate参数设置为true (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"RotateKubeletServerCertificate","path":"{.featureGates.RotateKubeletServerCertificate}","set":true,"compare":{"op":"eq","value":true}}]},"remediation":"编辑kubelet服务文件$kubeletsvc 在每个工作节点上，在 KUBELET_CERTIFICATE_ARGS 变量中设置以下参数 --feature-gates=RotateKubeletServerCertificate=true 根据您的系统，重新启动 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"2.1.15","text":"确保Kubelet仅使用强加密密码 (不计分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--tls-cipher-suites","path":"{.tlsCipherSuites}","set":true,"compare":{"op":"valid_elements","value":"TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256"}}]},"remediation":"如果使用Kubelet配置文件，编辑该文件设置 TLSCipherSuites 为: TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256\nIf using executable arguments, edit the kubelet service file $kubeletsvc on each worker node and set the below parameter.\n--tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256\n","scored":false}]},{"id":"2.2","text":"配置文件","checks":[{"id":"2.2.1","text":"确保将kubelet service文件权限设置为644或更严格 (计入分数)","audit":"/bin/sh -c ''if test -e $kubeletkubeconfig; then stat -c permissions=%a $kubeletkubeconfig; fi'' ","tests":{"test_items":[{"flag":"permissions","compare":{"op":"bitmask","value":"644"},"set":true}]},"remediation":"在每个工作节点上运行以下命令（基于系统上的文件位置）。例如，\nchmod 644 $kubeletkubeconfig\n","scored":true},{"id":"2.2.2","text":"确保将kubelet.conf文件权限设置为644或更严格 (计入分数)","audit":"/bin/sh -c ''if test -e $kubeletkubeconfig; then stat -c %U:%G $kubeletkubeconfig; fi'' ","tests":{"test_items":[{"flag":"root:root","set":true,"compare":{"op":"eq","value":"root:root"}}]},"remediation":"在每个工作节点上运行以下命令（基于系统上的文件位置）。例如，\nchown root:root $kubeletkubeconfig\n","scored":true},{"id":"2.2.3","text":"确保将kubelet.conf文件所有权设置为root:root (计入分数)","audit":"/bin/sh -c ''if test -e $kubeletsvc; then stat -c permissions=%a $kubeletsvc; fi'' ","tests":{"test_items":[{"flag":"permissions","set":true,"compare":{"op":"bitmask","value":"644"}}]},"remediation":"在每个工作节点上运行以下命令（基于系统上的文件位置）。例如，\nchmod 644 $kubeletsvc\n","scored":true},{"id":"2.2.4","text":"确保将kubelet service文件所有权设置为root:root (计入分数)","audit":"/bin/sh -c ''if test -e $kubeletsvc; then stat -c %U:%G $kubeletsvc; fi'' ","tests":{"test_items":[{"flag":"root:root","set":true}]},"remediation":"在每个工作节点上运行以下命令（基于系统上的文件位置）。例如，\nchown root:root $kubeletsvc\n","scored":true},{"id":"2.2.5","text":"确保将kubeconfig文件权限设置为644或更严格 (计入分数)","audit":"/bin/sh -c ''if test -e $proxykubeconfig; then stat -c permissions=%a $proxykubeconfig; fi'' ","tests":{"test_items":[{"flag":"permissions","set":true,"compare":{"op":"bitmask","value":"644"}}]},"remediation":"在每个工作节点上运行以下命令（基于系统上的文件位置）。例如，\nchmod 644 $proxykubeconfig\n","scored":true},{"id":"2.2.6","text":"确保将kubeconfig文件所有权设置为root:root (计入分数)","audit":"/bin/sh -c ''if test -e $proxykubeconfig; then stat -c %U:%G $proxykubeconfig; fi'' ","tests":{"test_items":[{"flag":"root:root","set":true}]},"remediation":"在每个工作节点上运行以下命令（基于系统上的文件位置）。例如，\nchown root:root $proxykubeconfig\n","scored":true},{"id":"2.2.7","text":"确保kubelet配置文件的权限设置为644或更严格 (计入分数)","type":"manual","remediation":"运行以下命令修改 --client-ca-file 文件的权限 chmod 644 <filename>\nchmod 644 <filename>\n","scored":true},{"id":"2.2.8","text":"确保将client certificate authorities文件所有权设置为root:root (计入分数)","audit":"CAFILE=$(ps -ef | grep kubelet | grep -v apiserver | grep -- --client-ca-file= | awk -F ''--client-ca-file='' ''{print $2}'' | awk ''{print $1}'')\nif [[ -z $CAFILE ]]; then\n  CAFILE=$kubeletcafile\nfi\nif test -e $CAFILE; then stat -c %U:%G $CAFILE; fi\n","tests":{"test_items":[{"flag":"root:root","set":true,"compare":{"op":"eq","value":"root:root"}}]},"remediation":"运行以下命令以修改 --client-ca-file 的所有权\nchown root:root <filename>\n","scored":true},{"id":"2.2.9","text":"确保kubelet配置文件的用户为root:root (计入分数)","audit":"/bin/sh -c ''if test -e $kubeletconf; then stat -c %U:%G $kubeletconf; fi'' ","tests":{"test_items":[{"flag":"root:root","set":true}]},"remediation":"运行以下命令（使用在审计步骤中的配置文件位置）\nchown root:root $kubeletconf\n","scored":true},{"id":"2.2.10","text":"确保kubelet配置文件的权限设置为644或更严格 (计入分数)","audit":"/bin/sh -c ''if test -e $kubeletconf; then stat -c permissions=%a $kubeletconf; fi'' ","tests":{"test_items":[{"flag":"permissions","set":true,"compare":{"op":"bitmask","value":"644"}}]},"remediation":"运行以下命令（使用在审计步骤中的配置文件位置）\nchmod 644 $kubeletconf\n","scored":true}]}]}', null, null, null, null, null, null, null, null, null, null, null, null);  END IF; END $do$;`
	DefaultK8sBenchCis14Sql = `DO $do$ BEGIN IF NOT EXISTS (SELECT from system_template WHERE id='9b4320a4-57f5-4559-a91b-d84b0d0a0f02') THEN INSERT INTO public.system_template (id, account, name, description, type, version, commands, status, is_default, config_mode, default_targets, check_master_json, check_node_json, check_control_plane_json, check_etcd_json, check_policies_json, check_managed_services_json, check_ids_master, check_ids_node, check_ids_control_plane, check_ids_etcd, check_ids_policies, check_ids_managed_services, check_ids_docker, check_ids_docker_check) VALUES ('9b4320a4-57f5-4559-a91b-d84b0d0a0f02', 'admin', 'CIS标准-Kubernetes benchmark', '', 'KubernetesBenchMark', 'cis-1.4', 'docker run --rm --pid=host -v /etc:/etc:ro -v /var:/var:ro -t registry.cn-qingdao.aliyuncs.com/diss/kube-bench:v0.3.0', 'Enable', false,  'target', '{"master":true,"node":true}', '{"controls":null,"version":1.13,"id":1,"text":"Master Node安全配置要求","type":"master","groups":[{"id":1.1,"text":"API服务器","checks":[{"id":"1.1.1","text":"确保将--anonymous-auth参数设置为false (不计分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--anonymous-auth","compare":{"op":"eq","value":false},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf，设置以下参数 --anonymous-auth=false\n","scored":false},{"id":"1.1.2","text":"确保未设置--basic-auth-file参数 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--basic-auth-file","set":false}]},"remediation":"按照文档和配置备用机制进行身份验证。然后，在主节点上编辑API服务器Pod配置文件$apiserverconf ，删除 --basic-auth-file=<filename> 参数。\n","scored":true},{"id":"1.1.3","text":"确保未设置--insecure-allow-any-token参数 (不计分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--insecure-allow-any-token","set":false}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf，删除--insecure-allow-any-token参数。\n","scored":true},{"id":"1.1.4","text":"确保将--kubelet-https参数设置为true (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--kubelet-https","compare":{"op":"eq","value":true},"set":true},{"flag":"--kubelet-https","set":false}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf，删除 --kubelet-https 参数。\n","scored":true},{"id":"1.1.5","text":"确保未设置--insecure-bind-address参数 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--insecure-bind-address","set":false}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf，删除 --insecure-bind-address 参数。\n","scored":true},{"id":"1.1.6","text":"确保将--insecure-port参数设置为0 0 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--insecure-port","compare":{"op":"eq","value":0},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf，设置以下参数 --insecure-port=0\n","scored":true},{"id":"1.1.7","text":"确保将--secure-port参数未设置为0 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--secure-port","compare":{"op":"gt","value":0},"set":true},{"flag":"--secure-port","set":false}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf，删除 --secure-port 参数或将其设置为其他（非零）端口。\n","scored":true},{"id":"1.1.8","text":"确保将--profiling参数设置为false (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--profiling","compare":{"op":"eq","value":false},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf，设置以下参数 --profiling=false\n","scored":true},{"id":"1.1.9","text":"确保将--repair-malformed-updates参数设置为false (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--repair-malformed-updates","compare":{"op":"eq","value":false},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf，设置以下参数 --repair-malformed-updates=false\n","scored":true},{"id":"1.1.10","text":"确保未设置许可控制插件AlwaysAdmit (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--enable-admission-plugins","compare":{"op":"nothave","value":"AlwaysAdmit"},"set":true},{"flag":"--enable-admission-plugins","set":false}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf，将 --enable-admission-plugins 参数设置为不包含 AlwaysAdmit 的值。\n","scored":true},{"id":"1.1.11","text":"确保已设置许可控制插件AlwaysPullImages (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--enable-admission-plugins","compare":{"op":"has","value":"AlwaysPullImages"},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf ，将 --enable-admission-plugins 参数设置为包含 AlwaysPullImages 的值。例如: --enable-admission-plugins=...，AlwaysPullImages，...\n","scored":true},{"id":"1.1.12","text":"[DEPRECATED] 确保设置了许可控制插件DenyEscalatingExec (不计分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","type":"skip","tests":{"test_items":[{"flag":"--enable-admission-plugins","compare":{"op":"has","value":"DenyEscalatingExec"},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf ，将 --enable-admission-plugins 参数设置为包含 DenyEscalatingExec 的值。—enable-admission-plugins=...，DenyEscalatingExec，...\n","scored":false},{"id":"1.1.13","text":"确保已设置许可控制插件SecurityContextDeny (不计分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--enable-admission-plugins","compare":{"op":"has","value":"SecurityContextDeny"},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf ，将 --enable-admission-plugins 参数设置为包含 SecurityContextDeny 的值。 --enable-admission-plugins=...，SecurityContextDeny，...\n","scored":false},{"id":"1.1.14","text":"确保设置了许可控制插件NamespaceLifecycle (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--disable-admission-plugins","compare":{"op":"nothave","value":"NamespaceLifecycle"},"set":true},{"flag":"--disable-admission-plugins","set":false}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf ，设置 --disable-admission-plugins 参数以确保它不包含 NamespaceLifecycle。\n","scored":true},{"id":"1.1.15","text":"确保--audit-log-path参数已设置为适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--audit-log-path","set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf ，将 --audit-log-path 参数设置为您希望审核日志的合适路径和文件例如:--audit-log-path=/var/log/apiserver/audit.log\n","scored":true},{"id":"1.1.16","text":"确保--audit-log-maxage参数设置为30或适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--audit-log-maxage","compare":{"op":"gte","value":30},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf ，将--audit-log-maxage 参数设置为30或适当的天数: --audit-log-maxage=30\n","scored":true},{"id":"1.1.17","text":"确保--audit-log-maxbackup参数设置为10或适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--audit-log-maxbackup","compare":{"op":"gte","value":10},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf ，将--audit-log-maxbackup 参数设置为10或适当的值。--audit-log-maxbackup=10\n","scored":true},{"id":"1.1.18","text":"确保--audit-log-maxsize参数设置为100或适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--audit-log-maxsize","compare":{"op":"gte","value":100},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf ，将 --audit-log-maxsize 参数设置为适当的大小（MB）。例如，要将其设置为100 MB:--audit-log-maxsize=100\n","scored":true},{"id":"1.1.19","text":"确保--authorization-mode参数未设置为AlwaysAllow (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--authorization-mode","compare":{"op":"nothave","value":"AlwaysAllow"},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf ，将--authorization-mode设置为AlwaysAllow参数以外的值。例如: --authorization-mode=Node, RBAC\n","scored":true},{"id":"1.1.20","text":"确保未设置--token-auth-file参数 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--token-auth-file","set":false}]},"remediation":"Follow the documentation and configure alternate mechanisms for authentication. Then,\nedit the API server pod specification file $apiserverconf\non the master node and remove the --token-auth-file=<filename>\nparameter.\n","scored":true},{"id":"1.1.21","text":"确保--kubelet-certificate-authority参数设置为适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--kubelet-certificate-authority","set":true}]},"remediation":"按照Kubernetes文档设置apiserver和kubelet之间的TLS连接。然后，在主节点上编辑API服务器Pod配置文件$apiserverconf ,将 --kubelet-certificate-authority 参数设置为证书颁发机构的cert文件的路径。 --kubelet-certificate-authority=<ca-string>\n","scored":true},{"id":"1.1.22","text":"确保--kubelet-client-certificate和--kubelet-client- key参数设置为适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"and","test_items":[{"flag":"--kubelet-client-certificate","set":true},{"flag":"--kubelet-client-key","set":true}]},"remediation":"按照Kubernetes文档设置apiserver和kubelet之间的TLS连接。然后，在主节点上编辑API服务器Pod配置文件$apiserverconf ,设置kubelet客户端证书和关键参数，如下所示 --kubelet-client-certificate=<path/to/client-certificate-file> --kubelet-client-key=<path/to/client-key-file>\n","scored":true},{"id":"1.1.23","text":"确保--service-account-lookup参数设置为true (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--service-account-lookup","set":false},{"flag":"--service-account-lookup","compare":{"op":"eq","value":true},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf，设置以下参数 --service-account-lookup=true\n","scored":true},{"id":"1.1.24","text":"确保已设置许可控制插件PodSecurityPolicy (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--enable-admission-plugins","compare":{"op":"has","value":"PodSecurityPolicy"},"set":true}]},"remediation":"按照文档根据您的环境创建Pod安全策略对象。然后，在主节点上编辑API服务器Pod配置文件$apiserverconf ，将 --enable-admission-plugins 参数设置为包含PodSecurityPolicyenable的值: --admission-plugins=...，PodSecurityPolicy，... 然后重新启动API服务器。\n","scored":true},{"id":"1.1.25","text":"确保--service-account-key-file参数设置为适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--service-account-key-file","set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf ，将--service-account-key-file参数设置为服务帐户的公钥文件：--service-account-key文件=<文件名>\n","scored":true},{"id":"1.1.26","text":"确保--etcd-certfile和--etcd-keyfile参数设置为适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"and","test_items":[{"flag":"--etcd-certfile","set":true},{"flag":"--etcd-keyfile","set":true}]},"remediation":"按照Kubernetes文档在apiserver和etcd之间设置TLS连接。然后，在主节点上编辑API服务器Pod配置文件$apiserverconf ，设置etcd证书和密钥文件参数。--etcd-certfile=<path/to/client-certificate-file> --etcd-keyfile=<path/to/client-key-file>\n","scored":true},{"id":"1.1.27","text":"确保设置了许可控制插件ServiceAccount (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--disable-admission-plugins","compare":{"op":"nothave","value":"ServiceAccount"},"set":true},{"flag":"--disable-admission-plugins","set":false}]},"remediation":"按照文档根据您的环境创建ServiceAccount对象。 然后，在主节点上编辑API服务器Pod配置文件$apiserverconf ，确保将--disable-admission-plugins参数设置为不包含ServiceAccount的值。\n","scored":true},{"id":"1.1.28","text":"确保根据需要设置--tls-cert-file和--tls-private-key-file参数 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"and","test_items":[{"flag":"--tls-cert-file","set":true},{"flag":"--tls-private-key-file","set":true}]},"remediation":"按照Kubernetes文档在apiserver上设置TLS连接。然后，在主节点上编辑API服务器Pod配置文件$apiserverconf ，设置TLS证书和私钥文件参数。\n--tls-cert-file=<path/to/tls-certificate-file> --tls-private-key-file=<path/to/tls-key-file>\n","scored":true},{"id":"1.1.29","text":"确保将--client-ca-file参数设置为适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--client-ca-file","set":true}]},"remediation":"按照Kubernetes文档在apiserver上设置TLS连接。然后，在主节点上编辑API服务器Pod配置文件$apiserverconf ，设置客户端证书颁发机构文件。\n--client-ca-file=<path/to/client-ca-file>\n","scored":true},{"id":"1.1.30","text":"确保--etcd-cafile参数设置为适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--etcd-cafile","set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf ，将--authorization-mode参数设置为包含Node的值。\n--authorization-mode=Node,RBAC\n","scored":true},{"id":"1.1.31","text":"确保API服务器仅使用强加密密码 (不计分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--tls-cipher-suites","compare":{"op":"has","value":"TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256"},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf 设置以下参数 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM _SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM _SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM _SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256\n","scored":false},{"id":"1.1.32","text":"确保--authorization-mode参数包含Node (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--authorization-mode","compare":{"op":"has","value":"Node"},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf ，将--authorization-mode参数设置为包含Node的值。\n--authorization-mode=Node,RBAC\n","scored":true},{"id":"1.1.33","text":"确保设置了许可控制插件NodeRestriction (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--enable-admission-plugins","compare":{"op":"has","value":"NodeRestriction"},"set":true}]},"remediation":"按照Kubernetes文档在kubelet上配置 NodeRestriction 插件。然后，在主节点上编辑API服务器Pod配置文件$apiserverconf ，将 --enable-admission-plugins 参数设置为包含 NodeRestriction 的值。 --enable-admission-plugins=...，NodeRestriction，...\n","scored":true},{"id":"1.1.34","text":"Ensure that the --encryption-provider-config argument is set as appropriate (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--encryption-provider-config","set":true}]},"remediation":"[手动测试]\n按照Kubernetes文档配置 EncryptionConfig 文件。然后，在主节点上编辑API服务器Pod配置文件$apiserverconf ，将 --encryption-provider-config 参数设置为该文件的路径:--encryption -provider-config=</path/to/EncryptionConfig/File>\n","scored":true},{"id":"1.1.35","text":"确保将加密提供程序设置为aescbc (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","type":"manual","remediation":"[手动测试]\n按照Kubernetes文档配置 EncryptionConfig 文件。在此文件中，选择 aescbc 作为加密提供程序。例如：\nkind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n    - secrets\n      providers:\n      - aescbc:\n          keys:\n          - name: key1\n            secret: <32-byte base64-encoded secret>\n","scored":true},{"id":"1.1.36","text":"确保设置了许可控制插件EventRateLimit (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--enable-admission-plugins","compare":{"op":"has","value":"EventRateLimit"},"set":true}]},"remediation":"按照Kubernetes文档在配置文件中设置所需的限制。然后，在主节点上编辑API服务器Pod配置文件$apiserverconf , 设置以下参数\n--enable-admission-plugins=...,EventRateLimit,...\n--admission-control-config-file=<path/to/configuration/file>\n","scored":true},{"id":"1.1.37a","text":"确保AdvancedAuditing参数未设置为false (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--feature-gates","compare":{"op":"nothave","value":"AdvancedAuditing=false"},"set":true},{"flag":"--feature-gates","set":false}]},"remediation":"按照Kubernetes文档在$apiserverconf 文件中设置所需的审核策略。然后，在主节点上编辑API服务器Pod配置文件$apiserverconf ,设置以下参数\n--audit-policy-file=/etc/kubernetes/audit-policy.yaml\n","scored":true},{"id":"1.1.37b","text":"确保AdvancedAuditing参数未设置为false (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--audit-policy-file","compare":{"op":"eq","value":"/etc/kubernetes/audit-policy.yaml"},"set":true},{"flag":"--audit-policy-file","compare":{"op":"eq","value":"/etc/kubernetes/audit-policy.yml"},"set":true}]},"remediation":"按照Kubernetes文档在$apiserverconf 文件中设置所需的审核策略。然后，在主节点上编辑API服务器Pod配置文件$apiserverconf ,设置以下参数\n--audit-policy-file=/etc/kubernetes/audit-policy.yaml\n","scored":true},{"id":"1.1.38","text":"确保--request-timeout参数设置为适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--request-timeout","set":false},{"flag":"--request-timeout","set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf  根据需要设置以下参数 例如:\n--request-timeout=300s\n","scored":true},{"id":"1.1.39","text":"确保--authorization-mode参数包含RBAC (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--authorization-mode","compare":{"op":"has","value":"RBAC"},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件 $apiserverbin 将--authorization-mode参数设置为包含RBAC的值，例如：--authorization-mode=Node,RBAC\n","scored":true}]},{"id":1.2,"text":"调度程序","checks":[{"id":"1.2.1","text":"确保将--profiling参数设置为false (计入分数)","audit":"/bin/ps -ef | grep $schedulerbin | grep -v grep","tests":{"test_items":[{"flag":"--profiling","compare":{"op":"eq","value":false},"set":true}]},"remediation":"编辑主节点上的Scheduler Pod配置文件$schedulerconf文件，设置以下参数\n --profiling=false\n","scored":true},{"id":"1.2.2","text":"确保--address参数设置为 127.0.0.1 (计入分数)","audit":"/bin/ps -ef | grep $schedulerbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--address","compare":{"op":"eq","value":"127.0.0.1"},"set":true},{"flag":"--address","set":false}]},"remediation":"编辑调度程序Pod配置文件$schedulerconf 确保--address参数的值是正确的\n","scored":true}]},{"id":1.3,"text":"控制器管理","checks":[{"id":"1.3.1","text":"确保将--terminated-pod-gc-threshold参数设置合适 (计入分数)","audit":"/bin/ps -ef | grep $controllermanagerbin | grep -v grep","tests":{"test_items":[{"flag":"--terminated-pod-gc-threshold","set":true}]},"remediation":"在主节点上编辑Controller Manager Pod配置文件$controllermanagerconf ，将 --terminated-pod-gc-threshold 设置为适当的阈值，例如:\n--terminated-pod-gc-threshold=10\n","scored":true},{"id":"1.3.2","text":"确保将--profiling参数设置为false (计入分数)","audit":"/bin/ps -ef | grep $controllermanagerbin | grep -v grep","tests":{"test_items":[{"flag":"--profiling","compare":{"op":"eq","value":false},"set":true}]},"remediation":"在主节点上编辑Controller Manager Pod配置$controllermanagerconf ，设置以下参数\n--profiling=false\n","scored":true},{"id":"1.3.3","text":"确保将--use-service-account-credentials参数设置为true (计入分数)","audit":"/bin/ps -ef | grep $controllermanagerbin | grep -v grep","tests":{"test_items":[{"flag":"--use-service-account-credentials","compare":{"op":"noteq","value":false},"set":true}]},"remediation":"编辑Controller Manager Pod配置文件$controllermanagerconf 在主节点上，设置以下参数\n--use-service-account-credentials=true\n","scored":true},{"id":"1.3.4","text":"确保将--service-account-private-key-file参数设置为适当的值 (计入分数)","audit":"/bin/ps -ef | grep $controllermanagerbin | grep -v grep","tests":{"test_items":[{"flag":"--service-account-private-key-file","set":true}]},"remediation":"在主节点上编辑Controller Manager Pod配置文件$controllermanagerconf ，将 --service-account-private-key-file 参数设置为服务帐户的私钥文件\n--service-account-private-key-file=<filename>\n","scored":true},{"id":"1.3.5","text":"确保正确设置--root-ca-file参数 (计入分数)","audit":"/bin/ps -ef | grep $controllermanagerbin | grep -v grep","tests":{"test_items":[{"flag":"--root-ca-file","set":true}]},"remediation":"在主节点上编辑Controller Manager Pod配置文件$controllermanagerconf ，将 --root-ca-file文件 参数设置为证书捆绑。\n--root-ca-file=<path/to/file>\n","scored":true},{"id":"1.3.6","text":"确保将RotateKubeletServerCertificate参数设置为true (计入分数)","audit":"/bin/ps -ef | grep $controllermanagerbin | grep -v grep","tests":{"test_items":[{"flag":"--feature-gates","compare":{"op":"eq","value":"RotateKubeletServerCertificate=true"},"set":true}]},"remediation":"在主节点上编辑Controller Manager Pod配置文件$controllermanagerconf ，将 --feature-gates 参数设置为包含 RotateKubeletServerCertificate=true。\n--feature-gates=RotateKubeletServerCertificate=true\n","scored":true},{"id":"1.3.7","text":"确保--address参数设置为 127.0.0.1 (计入分数)","audit":"/bin/ps -ef | grep $controllermanagerbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--address","compare":{"op":"eq","value":"127.0.0.1"},"set":true},{"flag":"--address","set":false}]},"remediation":"在主节点上编辑Controller Manager Pod配置文件$controllermanagerconf ，确保 --address 参数的值正确\n","scored":true}]},{"id":1.4,"text":"配置文件","checks":[{"id":"1.4.1","text":"确保将API server Pod配置文件权限设置为644或更严格","audit":"/bin/sh -c ''if test -e $apiserverconf; then stat -c permissions=%a $apiserverconf; fi''","tests":{"test_items":[{"flag":"permissions","compare":{"op":"bitmask","value":"644"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchmod 644 $apiserverconf\n","scored":true},{"id":"1.4.2","text":"确保将API server pod配置文件所有权设置为root:root (计入分数)","audit":"/bin/sh -c ''if test -e $apiserverconf; then stat -c %U:%G $apiserverconf; fi''","tests":{"test_items":[{"flag":"root:root","compare":{"op":"eq","value":"root:root"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchown root:root $apiserverconf\n","scored":true},{"id":"1.4.3","text":"确保将controller manager配置文件权限设置为644或更严格 (计入分数)","audit":"/bin/sh -c ''if test -e $controllermanagerconf; then stat -c permissions=%a $controllermanagerconf; fi''","tests":{"test_items":[{"flag":"permissions","compare":{"op":"bitmask","value":"644"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchmod 644 $controllermanagerconf\n","scored":true},{"id":"1.4.4","text":"确保将controller manager配置文件所有权设置为root:root (计入分数)","audit":"/bin/sh -c ''if test -e $controllermanagerconf; then stat -c %U:%G $controllermanagerconf; fi''","tests":{"test_items":[{"flag":"root:root","compare":{"op":"eq","value":"root:root"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchown root:root $controllermanagerconf\n","scored":true},{"id":"1.4.5","text":"确保将scheduler pod配置文件权限设置为644或更严格 (计入分数)","audit":"/bin/sh -c ''if test -e $schedulerconf; then stat -c permissions=%a $schedulerconf; fi''","tests":{"test_items":[{"flag":"permissions","compare":{"op":"bitmask","value":"644"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchmod 644 $schedulerconf\n","scored":true},{"id":"1.4.6","text":"确保将scheduler pod 配置文件所有权设置为root:root (计入分数)","audit":"/bin/sh -c ''if test -e $schedulerconf; then stat -c %U:%G $schedulerconf; fi''","tests":{"test_items":[{"flag":"root:root","compare":{"op":"eq","value":"root:root"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchown root:root $schedulerconf\n","scored":true},{"id":"1.4.7","text":"确保将etcd pod配置文件权限设置为644或更严格 (计入分数)","audit":"/bin/sh -c ''if test -e $etcdconf; then stat -c permissions=%a $etcdconf; fi''","tests":{"test_items":[{"flag":"permissions","compare":{"op":"bitmask","value":"644"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchmod 644 $etcdconf\n","scored":true},{"id":"1.4.8","text":"确保将etcd pod 配置文件所有权设置为 root:root(计入分数)","audit":"/bin/sh -c ''if test -e $etcdconf; then stat -c %U:%G $etcdconf; fi''","tests":{"test_items":[{"flag":"root:root","compare":{"op":"eq","value":"root:root"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchown root:root $etcdconf\n","scored":true},{"id":"1.4.9","text":"确保将Container Network Interface文件权限设置为644或更严格 (不计分数)","audit":"stat -c permissions=%a <path/to/cni/files>","type":"manual","remediation":"[手动测试]\n在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchmod 644 <path/to/cni/files>\n","scored":true},{"id":"1.4.10","text":"确保将Container Network Interfac文件所有权设置为root:root (不计分数)","audit":"stat -c %U:%G <path/to/cni/files>","type":"manual","remediation":"[手动测试]\n在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchown root:root <path/to/cni/files>\n","scored":true},{"id":"1.4.11","text":"确保将etcd data文件夹权限设置为700或更严格 (计入分数)","audit":"ps -ef | grep $etcdbin | grep -- --data-dir | sed ''s%.*data-dir[= ]\\([^ ]*\\).*%\\1%'' | xargs stat -c permissions=%a","tests":{"test_items":[{"flag":"permissions","compare":{"op":"bitmask","value":"700"},"set":true}]},"remediation":"在etcd服务器节点上获取etcd数据目录，作为参数传递 --data-dir，从以下命令:\nps -ef | grep $etcdbin\n运行以下命令（基于上面找到的etcd数据目录）。例如，\nchmod 700 /var/lib/etcd\n","scored":true},{"id":"1.4.12","text":"确保将etcd data文件夹所有权设置为etcd:etcd (计入分数)","audit":"ps -ef | grep $etcdbin | grep -- --data-dir | sed ''s%.*data-dir[= ]\\([^ ]*\\).*%\\1%'' | xargs stat -c %U:%G","tests":{"test_items":[{"flag":"etcd:etcd","set":true}]},"remediation":"在etcd服务器节点上获取etcd数据目录，作为参数传递 --data-dir，从以下命令:\nps -ef | grep $etcdbin\n运行以下命令（基于上面找到的etcd数据目录）。例如，\nchown etcd:etcd /var/lib/etcd\n","scored":true},{"id":"1.4.13","text":"确保将admin.conf权限设置为644或更严格 (计入分数)","audit":"/bin/sh -c ''if test -e /etc/kubernetes/admin.conf; then stat -c permissions=%a /etc/kubernetes/admin.conf; fi''","tests":{"test_items":[{"flag":"permissions","compare":{"op":"bitmask","value":"644"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchmod 644 /etc/kubernetes/admin.conf\n","scored":true},{"id":"1.4.14","text":"确保将admin.conf文件所有权设置为root:root (计入分数)","audit":"/bin/sh -c ''if test -e /etc/kubernetes/admin.conf; then stat -c %U:%G /etc/kubernetes/admin.conf; fi''","tests":{"test_items":[{"flag":"root:root","compare":{"op":"eq","value":"root:root"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchown root:root /etc/kubernetes/admin.conf\n","scored":true},{"id":"1.4.15","text":"确保将scheduler.conf权限设置为644或更严格 (计入分数)","audit":"/bin/sh -c ''if test -e /etc/kubernetes/scheduler.conf; then stat -c permissions=%a /etc/kubernetes/scheduler.conf; fi''","tests":{"test_items":[{"flag":"permissions","compare":{"op":"bitmask","value":"644"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如， chmod 644 /etc/kubernetes/scheduler.conf\n","scored":true},{"id":"1.4.16","text":"确保将scheduler.conf文件所有权设置为root:root (计入分数)","audit":"/bin/sh -c ''if test -e /etc/kubernetes/scheduler.conf; then stat -c %U:%G /etc/kubernetes/scheduler.conf; fi''","tests":{"test_items":[{"flag":"root:root","compare":{"op":"eq","value":"root:root"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如， chown root:root /etc/kubernetes/scheduler.conf\n","scored":true},{"id":"1.4.17","text":"确保将controller-manager.conf 权限设置为644或更严格 (计入分数)","audit":"/bin/sh -c ''if test -e /etc/kubernetes/controller-manager.conf; then stat -c permissions=%a /etc/kubernetes/controller-manager.conf; fi''","tests":{"test_items":[{"flag":"permissions","compare":{"op":"bitmask","value":"644"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如， chmod 644 /etc/kubernetes/controller-manager.conf\n","scored":true},{"id":"1.4.18","text":"确保将controller-manager.conf文件所有权设置为root:root (计入分数)","audit":"/bin/sh -c ''if test -e /etc/kubernetes/controller-manager.conf; then stat -c %U:%G /etc/kubernetes/controller-manager.conf; fi''","tests":{"test_items":[{"flag":"root:root","compare":{"op":"eq","value":"root:root"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如， chown root:root /etc/kubernetes/controller-manager.conf\n","scored":true},{"id":"1.4.19","text":"Ensure that the Kubernetes PKI directory and file ownership is set to root:root (计入分数)","audit":"ls -laR /etc/kubernetes/pki/","type":"manual","tests":{"test_items":[{"flag":"root root","compare":{"op":"eq","value":"root root"},"set":true}]},"remediation":"[手动测试]\n在主节点上，运行以下命令（基于系统上的文件位置）。例如 chown -R root:root /etc/kubernetes/pki/\n","scored":true},{"id":"1.4.20","text":"Ensure that the Kubernetes PKI certificate file permissions are set to 644 or more restrictive (计入分数)","audit":"stat -c %n %a /etc/kubernetes/pki/*.crt","type":"manual","tests":{"test_items":[{"flag":"permissions","compare":{"op":"bitmask","value":"644"},"set":true}]},"remediation":"[手动测试]\n在主节点上，运行以下命令（基于系统上的文件位置）。例如 chmod -R 644 /etc/kubernetes/pki/*.crt\n","scored":true},{"id":"1.4.21","text":"Ensure that the Kubernetes PKI key file permissions are set to 600 or more restrictive (计入分数)","audit":"stat -c %n %a /etc/kubernetes/pki/*.key","type":"manual","tests":{"test_items":[{"flag":"permissions","compare":{"op":"bitmask","value":"600"},"set":true}]},"remediation":"[手动测试]\n在主节点上，运行以下命令（基于系统上的文件位置）。例如 chmod -R 600 /etc/kubernetes/pki/*.key\n","scored":true}]},{"id":1.5,"text":"etcd配置","checks":[{"id":"1.5.1","text":"确保将--cert-file和--key-file参数设置为适当的值 (计入分数)","audit":"/bin/ps -ef | grep $etcdbin | grep -v grep","tests":{"test_items":[{"flag":"--cert-file","set":true},{"flag":"--key-file","set":true}]},"remediation":"按照etcd服务文档配置TLS加密。然后，在主节点上编辑etcd Pod配置文件$etcdconf l，设置以下参数 --cert-file=</path/to/ca-file> --key-file=</path/to/key-file>\n--ca-file=</path/to/ca-file>\n--key-file=</path/to/key-file>\n","scored":true},{"id":"1.5.2","text":"确保将--client-cert-auth参数设置为true (计入分数)","audit":"/bin/ps -ef | grep $etcdbin | grep -v grep","tests":{"test_items":[{"flag":"--client-cert-auth","compare":{"op":"eq","value":true},"set":true}]},"remediation":"在主节点上编辑etcd Pod配置文件$etcdconf ，设置以下参数\n--client-cert-auth=\"true\"\n","scored":true},{"id":"1.5.3","text":"确保--auto-tls参数未设置为true (计入分数)","audit":"/bin/ps -ef | grep $etcdbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--auto-tls","set":false},{"flag":"--auto-tls","compare":{"op":"eq","value":false}}]},"remediation":"在主节点上编辑etcd Pod配置文件$etcdconf ，删除 --auto-tls 参数或将其设置为 false。\n  --auto-tls=false\n","scored":true},{"id":"1.5.4","text":"确保正确设置--peer-cert-file和--peer-key-file参数 (计入分数)","audit":"/bin/ps -ef | grep $etcdbin | grep -v grep","tests":{"bin_op":"and","test_items":[{"flag":"--peer-cert-file","set":true},{"flag":"--peer-key-file","set":true}]},"remediation":"按照etcd服务文档根据您的etcd群集配置对等TLS加密。然后，在主节点上编辑etcd Pod配置文件$etcdconf ，设置以下参数\n--peer-client-file=</path/to/peer-cert-file>\n--peer-key-file=</path/to/peer-key-file>\n","scored":true},{"id":"1.5.5","text":"确保将--peer-client-cert-auth参数设置为true (计入分数)","audit":"/bin/ps -ef | grep $etcdbin | grep -v grep","tests":{"test_items":[{"flag":"--peer-client-cert-auth","compare":{"op":"eq","value":true},"set":true}]},"remediation":"在主节点上编辑etcd Pod配置文件$etcdconf ，设置以下参数\n--peer-client-cert-auth=true\n","scored":true},{"id":"1.5.6","text":"确保--peer-auto-tls参数未设置为true (计入分数)","audit":"/bin/ps -ef | grep $etcdbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--peer-auto-tls","set":false},{"flag":"--peer-auto-tls","compare":{"op":"eq","value":false},"set":true}]},"remediation":"在主节点上编辑etcd Pod配置文件$etcdconf ，删除 --peer-auto-tls 参数或将其设置为 false。\n--peer-auto-tls=false\n","scored":true},{"id":"1.5.7","text":"确保将唯一的证书颁发机构用于etcd (不计分数)","audit":"/bin/ps -ef | grep $etcdbin | grep -v grep","type":"manual","tests":{"test_items":[{"flag":"--trusted-ca-file","set":true}]},"remediation":"[手动测试]\n按照etcd文档为etcd服务创建专用的证书颁发机构设置。 然后，在主节点上编辑etcd Pod配置文件$etcdconf ，设置以下参数\n--trusted-ca-file=</path/to/ca-file>\n","scored":false}]},{"id":1.6,"text":"基本安全设置","checks":[{"id":"1.6.1","text":"确保仅在需要时使用集群管理员角色 (不计分数)","type":"manual","remediation":"[手动测试]\n移除所有不必要的clusterrolebinding :\nkubectl delete clusterrolebinding [name]\n","scored":false},{"id":"1.6.2","text":"使用命名空间在资源之间创建管理边界 (不计分数)","type":"manual","remediation":"[手动测试]\n按照文档的说明，根据需要为部署中的对象创建名称空间。\n","scored":false},{"id":"1.6.3","text":"使用网络策略创建网络分段 (不计分数)","type":"manual","remediation":"[手动测试]\n按照文档根据需要创建NetworkPolicy对象。\n","scored":false},{"id":"1.6.4","text":"确保在pod定义中将seccomp配置文件设置为docker/default (不计分数)","type":"manual","remediation":"[手动测试]\nSeccomp目前是一个alpha功能。 默认情况下，禁用所有Alpha功能。 因此，您需要通过传递\"--featuregates=AllAlpha=true\"参数来启用apiserver中的alpha功能。\n编辑主节点上的/etc/kubernetes/apiserver文件，将KUBE_API_ARGS参数设置为\"--feature-gates=AllAlpha=true\"\nKUBE_API_ARGS=\"--feature-gates=AllAlpha=true\"\n根据您的系统，重新启动kube-apiserver服务。 例如：\nsystemctl restart kube-apiserver.service\n使用注释在pod定义中启用docker/default seccomp配置文件。 一个例子如下：\napiVersion: v1\nkind: Pod\nmetadata:\n  name: trustworthy-pod\n  annotations:\n    seccomp.security.alpha.kubernetes.io/pod: docker/default\nspec:\n  containers:\n    - name: trustworthy-container\n      image: sotrustworthy:latest\n","scored":false},{"id":"1.6.5","text":"将Security Context应用于您的Pod和容器 (不计分数)","type":"manual","remediation":"[手动测试]\n按照Kubernetes文档将Security Context应用到您的pod。 有关Security Context的建议列表，您可以参考Docker容器的CIS安全基准。\n","scored":false},{"id":"1.6.6","text":"使用ImagePolicyWebhook许可控制器配置Image Provenance (不计分数)","type":"manual","remediation":"[手动测试]\n按照Kubernetes文档设置Image Provenance。\n","scored":false},{"id":"1.6.7","text":"根据需要配置网络策略 (不计分数)","type":"manual","remediation":"[手动测试]\n按照Kubernetes文档根据需要设置网络策略。 例如，您可以通过创建NetworkPolicy为名称空间创建“默认”隔离策略，该策略选择所有Pod但不允许任何流量：\napiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: default-deny\nspec:\n  podSelector:\n","scored":false},{"id":"1.6.8","text":"以PSP和RBAC的形式为特权容器设置限制 (不计分数)","type":"manual","remediation":"[手动测试]\n按照Kubernetes文档为您的集群设置PSP和RBAC授权。\n","scored":false}]},{"id":1.7,"text":"POD安全策略","checks":[{"id":"1.7.1","text":"不接受特权容器 (不计分数)","type":"manual","remediation":"[手动测试]\n按照Kubernetes文档中的描述创建PSP，确保省略 .spec.privileged 字段或将其设置为false。\n","scored":false},{"id":"1.7.2","text":"不接受共享主机PID命名空间容器 (计入分数)","type":"manual","remediation":"[手动测试]\n按照Kubernetes文档中的描述创建PSP，确保省略 .spec.hostPID 字段或将其设置为false。\n","scored":false},{"id":"1.7.3","text":"不接受共享主机IPC命名空间容器 (计入分数)","type":"manual","remediation":"[手动测试]\n按照Kubernetes文档中的描述创建PSP，确保省略 .spec.hostIPC 字段或将其设置为false。\n","scored":false},{"id":"1.7.4","text":"不接受共享主机network命名空间容器 (计入分数)","type":"manual","remediation":"[手动测试]\n按照Kubernetes文档中的描述创建PSP，确保省略 .spec.hostNetwork 字段或将其设置为false。\n","scored":false},{"id":"1.7.5","text":" 不接受allowPrivilegeEscalation容器 (计入分数)","type":"manual","remediation":"[手动测试]\n按照Kubernetes文档中的描述创建PSP，确保省略 .spec.allowPrivilegeEscalation 字段或将其设置为false。\n","scored":false},{"id":"1.7.6","text":"不接受root用户运行的容器 (不计分数)","type":"manual","remediation":"[手动测试]\n按照Kubernetes文档中的描述创建PSP，确保 .spec.runAsUser.rule 设置为 MustRunAsNonRoot 或 MustRunAs 且 UID 不能为 0.\n","scored":false},{"id":"1.7.7","text":"不接受requiredDropCapabilities的容器 (不计分数)","type":"manual","remediation":"[手动测试]\n按照Kubernetes文档中的描述创建PSP，确保将 .spec.requiredDropCapabilities 设置为包含 NET_RAW 或 ALL。\n","scored":false}]}]}', '{"controls":null,"version":"1.13","id":"2","text":"Worker Node 安全配置要求","type":"node","groups":[{"id":"2.1","text":"Kubelet","checks":[{"id":"2.1.1","text":"确保将--anonymous-auth参数设置为false (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--anonymous-auth","path":"{.authentication.anonymous.enabled}","set":true,"compare":{"op":"eq","value":false}}]},"remediation":"如果使用Kubelet配置文件，请编辑该文件设置 authentication: anonymous: enabled 为 false。如果使用命令行参数，请在每个工作节点上编辑kubelet服务文件$kubeletsvc ，在 KUBELET_SYSTEM_PODS_ARGS 变量中设置以下参数 --anonymous-auth=false 根据您的系统，重新启动 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"2.1.2","text":"确保--authorization-mode参数未设置为AlwaysAllow (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--authorization-mode","path":"{.authorization.mode}","set":true,"compare":{"op":"nothave","value":"AlwaysAllow"}}]},"remediation":"如果使用Kubelet配置文件，请编辑该文件设置 authorization:mode 为 Webhook。如果使用命令行参数，请在每个工作节点上编辑kubelet服务文件$kubeletsvc ，在 KUBELET_AUTHZ_ARGS 变量中设置以下参数 --authorization-mode=Webhook 根据您的系统，重启 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"2.1.3","text":"确保将--client-ca-file参数设置为适当的值 (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--client-ca-file","path":"{.authentication.x509.clientCAFile}","set":true}]},"remediation":"如果使用Kubelet配置文件，请编辑该文件设置 authentication: x509: clientCAFile 为客户端CA文件的位置。如果使用命令行参数，请在每个工作节点上编辑kubelet服务文件$kubeletsvc ，在 KUBELET_AUTHZ_ARGS 变量中设置以下参数 --client-ca-file=<path/to/client-ca-file> 根据您的系统，重新启动 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"2.1.4","text":"确保将--read-only-port参数设置为0 (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--read-only-port","path":"{.readOnlyPort}","set":true,"compare":{"op":"eq","value":0}}]},"remediation":"如果使用Kubelet配置文件，请编辑该文件设置 readOnlyPort 为 0。如果使用命令行参数，请在每个工作节点上编辑kubelet服务文件$kubeletsvc ，在 KUBELET_SYSTEM_PODS_ARGS 变量中设置以下参数 --read-only-port=0 根据您的系统，重新启动 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"2.1.5","text":"确保--streaming-connection-idle-timeout参数未设置为0 (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--streaming-connection-idle-timeout","path":"{.streamingConnectionIdleTimeout}","set":true,"compare":{"op":"noteq","value":0}},{"flag":"--streaming-connection-idle-timeout","path":"{.streamingConnectionIdleTimeout}","set":false}],"bin_op":"or"},"remediation":"如果使用Kubelet配置文件，请编辑该文件设置 streamingConnectionIdleTimeout 为除0以外的值.如果使用命令行参数，请在每个工作节点上编辑kubelet服务文件$kubeletsvc ，在 KUBELET_SYSTEM_PODS_ARGS 变量中设置以下参数 --streaming-connection-idle-timeout=5m 根据您的系统，重启 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"2.1.6","text":"确保--protect-kernel-defaults参数设置为true (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--protect-kernel-defaults","path":"{.protectKernelDefaults}","set":true,"compare":{"op":"eq","value":true}}]},"remediation":"如果使用Kubelet配置文件，请编辑该文件设置 protectKernelDefaults: true。如果使用命令行参数，请在每个工作节点上编辑kubelet服务文件$kubeletsvc ，在 KUBELET_SYSTEM_PODS_ARGS 变量中设置以下参数 --protect-kernel-defaults=true 根据您的系统，重新启动 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"2.1.7","text":"确保--make-iptables-util-chains参数设置为true (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--make-iptables-util-chains","path":"{.makeIPTablesUtilChains}","set":true,"compare":{"op":"eq","value":true}},{"flag":"--make-iptables-util-chains","path":"{.makeIPTablesUtilChains}","set":false}],"bin_op":"or"},"remediation":"如果使用Kubelet配置文件，请编辑该文件设置 makeIPTablesUtilChains: true。如果使用命令行参数，请在每个工作节点上编辑kubelet服务文件$kubeletsvc ，从 KUBELET_CERTIFICATE_ARGS 变量中删除 --make-iptables-util-chains。 根据您的系统，重新启动 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"2.1.8","text":"确保未设置--hostname-override参数 (计入分数)","audit":"/bin/ps -fC $kubeletbin ","tests":{"test_items":[{"flag":"--hostname-override","set":false}]},"remediation":"编辑kubelet服务文件$kubeletsvc 在每个工作节点上，从 KUBELET_CERTIFICATE_ARGS 变量中删除 —hostname-override。 根据您的系统，重新启动 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"2.1.9","text":"确保将--event-qps参数设置为0 (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--event-qps","path":"{.eventRecordQPS}","set":true,"compare":{"op":"eq","value":0}}]},"remediation":"如果使用Kubelet配置文件，请编辑该文件设置 eventRecordQPS:0。如果使用命令行参数，请在每个工作节点上编辑kubelet服务文件$kubeletsvc ，在 KUBELET_SYSTEM_PODS_ARGS 变量中设置以下参数 --event-qps=0 根据您的系统，重新启动 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"2.1.10","text":"确保正确设置--tls-cert-file和--tls-private-key-file参数 (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--tls-cert-file","path":"{.tlsCertFile}","set":true},{"flag":"--tls-private-key-file","path":"{.tlsPrivateKeyFile}","set":true}],"bin_op":"and"},"remediation":"如果使用Kubelet配置文件，请编辑该文件将tlsCertFile设置为用于标识此Kubelet的证书文件的位置，将tlsPrivateKeyFile设置为相应私钥文件的位置。如果使用命令行参数，请在每个工作节点上编辑kubelet服务文件$kubeletsvc ，在KUBELET_CERTIFICATE_ARGS变量中设置以下参数 --tls-cert-file=<path/to/tls-certificate-file> --tls-private-key-file=<path/to/tls-key-file> 根据您的系统，重新启动 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"2.1.11","text":"[DEPRECATED] 确保--cadvisor-port参数设置为0","audit":"/bin/ps -fC $kubeletbin ","type":"skip","tests":{"test_items":[{"flag":"--cadvisor-port","set":true,"compare":{"op":"eq","value":0}},{"flag":"--cadvisor-port","set":false}],"bin_op":"or"},"remediation":"编辑kubelet服务文件$kubeletsvc 在每个工作节点上，在 KUBELET_CADVISOR_ARGS 变量中设置以下参数 --cadvisor-port=0 根据您的系统，重新启动 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":false},{"id":"2.1.12","text":"确保--rotate-certificates参数未设置为false (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--rotate-certificates","path":"{.rotateCertificates}","set":true,"compare":{"op":"eq","value":true}},{"flag":"--rotate-certificates","path":"{.rotateCertificates}","set":false}],"bin_op":"or"},"remediation":"如果使用Kubelet配置文件，请编辑该文件以添加行 rotateCertificates:true。如果使用命令行参数，请在每个工作节点上编辑kubelet服务文件$kubeletsvc ，将 --rotate-certificates=true 参数添加到 KUBELET_CERTIFICATE_ARGS 变量中。 根据您的系统，重新启动 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"2.1.13","text":"确保将RotateKubeletServerCertificate参数设置为true (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"RotateKubeletServerCertificate","path":"{.featureGates.RotateKubeletServerCertificate}","set":true,"compare":{"op":"eq","value":true}}]},"remediation":"编辑kubelet服务文件$kubeletsvc 在每个工作节点上，在 KUBELET_CERTIFICATE_ARGS 变量中设置以下参数 --feature-gates=RotateKubeletServerCertificate=true 根据您的系统，重新启动 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"2.1.14","text":"确保Kubelet仅使用强加密密码 (不计分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--tls-cipher-suites","path":"{range .tlsCipherSuites[:]}{}{'',''}{end}","set":true,"compare":{"op":"valid_elements","value":"TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256"}}]},"remediation":"如果使用Kubelet配置文件，编辑该文件设置 TLSCipherSuites 为: TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256\nIf using executable arguments, edit the kubelet service file $kubeletsvc on each worker node and set the below parameter.\n--tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256\n","scored":false}]},{"id":"2.2","text":"配置文件","checks":[{"id":"2.2.1","text":"确保将kubelet service文件权限设置为644或更严格 (计入分数)","audit":"/bin/sh -c ''if test -e $kubeletkubeconfig; then stat -c permissions=%a $kubeletkubeconfig; fi'' ","tests":{"test_items":[{"flag":"permissions","set":true,"compare":{"op":"bitmask","value":"644"}}]},"remediation":"在每个工作节点上运行以下命令（基于系统上的文件位置）。例如，\nchmod 644 $kubeletkubeconfig\n","scored":true},{"id":"2.2.2","text":"确保将kubelet.conf文件权限设置为644或更严格 (计入分数)","audit":"/bin/sh -c ''if test -e $kubeletkubeconfig; then stat -c %U:%G $kubeletkubeconfig; fi'' ","tests":{"test_items":[{"flag":"root:root","set":true,"compare":{"op":"eq","value":"root:root"}}]},"remediation":"在每个工作节点上运行以下命令（基于系统上的文件位置）。例如，\nchown root:root $kubeletkubeconfig\n","scored":true},{"id":"2.2.3","text":"确保将kubelet.conf文件所有权设置为root:root (计入分数)","audit":"/bin/sh -c ''if test -e $kubeletsvc; then stat -c permissions=%a $kubeletsvc; fi'' ","tests":{"test_items":[{"flag":"permissions","set":true,"compare":{"op":"bitmask","value":"644"}}]},"remediation":"在每个工作节点上运行以下命令（基于系统上的文件位置）。例如，\nchmod 644 $kubeletsvc\n","scored":true},{"id":"2.2.4","text":"确保将kubelet service文件所有权设置为root:root (计入分数)","audit":"/bin/sh -c ''if test -e $kubeletsvc; then stat -c %U:%G $kubeletsvc; fi'' ","tests":{"test_items":[{"flag":"root:root","set":true}]},"remediation":"在每个工作节点上运行以下命令（基于系统上的文件位置）。例如，\nchown root:root $kubeletsvc\n","scored":true},{"id":"2.2.5","text":"确保将kubeconfig文件权限设置为644或更严格 (计入分数)","audit":"/bin/sh -c ''if test -e $proxykubeconfig; then stat -c permissions=%a $proxykubeconfig; fi'' ","tests":{"test_items":[{"flag":"permissions","set":true,"compare":{"op":"bitmask","value":"644"}}]},"remediation":"在每个工作节点上运行以下命令（基于系统上的文件位置）。例如，\nchmod 644 $proxykubeconfig\n","scored":true},{"id":"2.2.6","text":"确保将kubeconfig文件所有权设置为root:root (计入分数)","audit":"/bin/sh -c ''if test -e $proxykubeconfig; then stat -c %U:%G $proxykubeconfig; fi'' ","tests":{"test_items":[{"flag":"root:root","set":true}]},"remediation":"在每个工作节点上运行以下命令（基于系统上的文件位置）。例如，\nchown root:root $proxykubeconfig\n","scored":true},{"id":"2.2.7","text":"确保kubelet配置文件的权限设置为644或更严格 (计入分数)","audit":"/bin/sh -c ''if test -e $kubeletcafile; then stat -c permissions=%a $kubeletcafile; fi''","tests":{"bin_op":"or","test_items":[{"flag":"permissions","compare":{"op":"bitmask","value":"644"},"set":true}]},"remediation":"运行以下命令修改 --client-ca-file 文件的权限 chmod 644 <filename>\nchmod 644 <filename>\n","scored":true},{"id":"2.2.8","text":"确保将client certificate authorities文件所有权设置为root:root (计入分数)","audit":"CAFILE=$(ps -ef | grep kubelet | grep -v apiserver | grep -- --client-ca-file= | awk -F ''--client-ca-file='' ''{print $2}'' | awk ''{print $1}'')\nif [[ -z $CAFILE ]]; then\n  CAFILE=$kubeletcafile\nfi\nif test -e $CAFILE; then stat -c %U:%G $CAFILE; fi\n","tests":{"test_items":[{"flag":"root:root","set":true,"compare":{"op":"eq","value":"root:root"}}]},"remediation":"运行以下命令以修改 --client-ca-file 的所有权\nchown root:root <filename>\n","scored":true},{"id":"2.2.9","text":"确保kubelet配置文件的用户为root:root (计入分数)","audit":"/bin/sh -c ''if test -e $kubeletconf; then stat -c %U:%G $kubeletconf; fi'' ","tests":{"test_items":[{"flag":"root:root","set":true}]},"remediation":"运行以下命令（使用在审计步骤中的配置文件位置）\nchown root:root $kubeletconf\n","scored":true},{"id":"2.2.10","text":"确保kubelet配置文件的权限设置为644或更严格 (计入分数)","audit":"/bin/sh -c ''if test -e $kubeletconf; then stat -c permissions=%a $kubeletconf; fi'' ","tests":{"test_items":[{"flag":"permissions","set":true,"compare":{"op":"bitmask","value":"644"}}]},"remediation":"运行以下命令（使用在审计步骤中的配置文件位置）\nchmod 644 $kubeletconf\n","scored":true}]}]}', null, null, null, null, null, null, null, null, null, null, null, null); END IF; END $do$;`
	DefaultK8sBenchCis15Sql = `DO $do$ BEGIN IF NOT EXISTS (SELECT from system_template WHERE id='9b4320a4-57f5-4559-a91b-d84b0d0a0f03') THEN INSERT INTO public.system_template (id, account, name, description, type, version, commands, status, is_default, config_mode, default_targets, check_master_json, check_node_json, check_control_plane_json, check_etcd_json, check_policies_json, check_managed_services_json, check_ids_master, check_ids_node, check_ids_control_plane, check_ids_etcd, check_ids_policies, check_ids_managed_services, check_ids_docker, check_ids_docker_check) VALUES ('9b4320a4-57f5-4559-a91b-d84b0d0a0f03', 'admin', 'CIS标准-Kubernetes benchmark', '', 'KubernetesBenchMark', 'cis-1.5', 'docker run --rm --pid=host -v /etc:/etc:ro -v /var:/var:ro -t registry.cn-qingdao.aliyuncs.com/diss/kube-bench:v0.3.0', 'Enable', false,  'target', '{"master":true,"node":true,"controlplane":true,"etcd":true,"policies":true}', '{"controls":null,"version":1.5,"id":1,"text":"Master Node 安全配置要求","type":"master","groups":[{"id":1.1,"text":"Master Node Configuration Files","checks":[{"id":"1.1.1","text":"确保将API server Pod配置文件权限设置为644或更严格 (计入分数)","audit":"/bin/sh -c ''if test -e $apiserverconf; then stat -c permissions=%a $apiserverconf; fi''","tests":{"test_items":[{"flag":"permissions","compare":{"op":"bitmask","value":"644"},"set":true}]},"remediation":"Run the below command (based on the file location on your system) on the\nmaster node.\nFor example, chmod 644 $apiserverconf\n","scored":true},{"id":"1.1.2","text":"Ensure that the API server pod specification file ownership is set to root:root (计入分数)","audit":"/bin/sh -c ''if test -e $apiserverconf; then stat -c %U:%G $apiserverconf; fi''","tests":{"test_items":[{"flag":"root:root","compare":{"op":"eq","value":"root:root"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchown root:root $apiserverconf\n","scored":true},{"id":"1.1.3","text":"Ensure that the controller manager pod specification file permissions are set to 644 or more restrictive (计入分数)","audit":"/bin/sh -c ''if test -e $controllermanagerconf; then stat -c permissions=%a $controllermanagerconf; fi''","tests":{"test_items":[{"flag":"permissions","compare":{"op":"bitmask","value":"644"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchmod 644 $controllermanagerconf\n","scored":true},{"id":"1.1.4","text":"Ensure that the controller manager pod specification file ownership is set to root:root (计入分数)","audit":"/bin/sh -c ''if test -e $controllermanagerconf; then stat -c %U:%G $controllermanagerconf; fi''","tests":{"test_items":[{"flag":"root:root","compare":{"op":"eq","value":"root:root"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchown root:root $controllermanagerconf\n","scored":true},{"id":"1.1.5","text":"Ensure that the scheduler pod specification file permissions are set to 644 or more restrictive (计入分数)","audit":"/bin/sh -c ''if test -e $schedulerconf; then stat -c permissions=%a $schedulerconf; fi''","tests":{"test_items":[{"flag":"permissions","compare":{"op":"bitmask","value":"644"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchmod 644 $schedulerconf\n","scored":true},{"id":"1.1.6","text":"Ensure that the scheduler pod specification file ownership is set to root:root (计入分数)","audit":"/bin/sh -c ''if test -e $schedulerconf; then stat -c %U:%G $schedulerconf; fi''","tests":{"test_items":[{"flag":"root:root","compare":{"op":"eq","value":"root:root"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchown root:root $schedulerconf\n","scored":true},{"id":"1.1.7","text":"Ensure that the etcd pod specification file permissions are set to 644 or more restrictive (计入分数)","audit":"/bin/sh -c ''if test -e $etcdconf; then stat -c permissions=%a $etcdconf; fi''","tests":{"test_items":[{"flag":"permissions","compare":{"op":"bitmask","value":"644"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchmod 644 $etcdconf\n","scored":true},{"id":"1.1.8","text":"Ensure that the etcd pod specification file ownership is set to root:root (计入分数)","audit":"/bin/sh -c ''if test -e $etcdconf; then stat -c %U:%G $etcdconf; fi''","tests":{"test_items":[{"flag":"root:root","compare":{"op":"eq","value":"root:root"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchown root:root $etcdconf\n","scored":true},{"id":"1.1.9","text":"Ensure that the Container Network Interface file permissions are set to 644 or more restrictive (不计分数)","audit":"stat -c permissions=%a <path/to/cni/files>","type":"manual","remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchmod 644 <path/to/cni/files>\n","scored":false},{"id":"1.1.10","text":"Ensure that the Container Network Interface file ownership is set to root:root (不计分数)","audit":"stat -c %U:%G <path/to/cni/files>","type":"manual","remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchown root:root <path/to/cni/files>\n","scored":false},{"id":"1.1.11","text":"确保将etcd data文件夹权限设置为700或更严格 (计入分数)","audit":"ps -ef | grep $etcdbin | grep -- --data-dir | sed ''s%.*data-dir[= ]\\([^ ]*\\).*%\\1%'' | xargs stat -c permissions=%a","tests":{"test_items":[{"flag":"permissions","compare":{"op":"bitmask","value":"700"},"set":true}]},"remediation":"On the etcd server node, get the etcd data directory, passed as an argument --data-dir,\nfrom the below command:\nps -ef | grep etcd\n运行以下命令（基于上面找到的etcd数据目录）。例如，\nchmod 700 /var/lib/etcd\n","scored":true},{"id":"1.1.12","text":"确保将etcd data文件夹所有权设置为etcd:etcd (计入分数)","audit":"ps -ef | grep $etcdbin | grep -- --data-dir | sed ''s%.*data-dir[= ]\\([^ ]*\\).*%\\1%'' | xargs stat -c %U:%G","tests":{"test_items":[{"flag":"etcd:etcd","set":true}]},"remediation":"On the etcd server node, get the etcd data directory, passed as an argument --data-dir,\nfrom the below command:\nps -ef | grep etcd\nRun the below command (based on the etcd data directory found above).\nFor example, chown etcd:etcd /var/lib/etcd\n","scored":true},{"id":"1.1.13","text":"Ensure that the admin.conf file permissions are set to 644 or more restrictive (计入分数)","audit":"/bin/sh -c ''if test -e /etc/kubernetes/admin.conf; then stat -c permissions=%a /etc/kubernetes/admin.conf; fi''","tests":{"test_items":[{"flag":"permissions","compare":{"op":"bitmask","value":"644"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchmod 644 /etc/kubernetes/admin.conf\n","scored":true},{"id":"1.1.14","text":"确保将admin.conf文件所有权设置为root:root (计入分数)","audit":"/bin/sh -c ''if test -e /etc/kubernetes/admin.conf; then stat -c %U:%G /etc/kubernetes/admin.conf; fi''","tests":{"test_items":[{"flag":"root:root","compare":{"op":"eq","value":"root:root"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchown root:root /etc/kubernetes/admin.conf\n","scored":true},{"id":"1.1.15","text":"Ensure that the scheduler.conf file permissions are set to 644 or more restrictive (计入分数)","audit":"/bin/sh -c ''if test -e /etc/kubernetes/scheduler.conf; then stat -c permissions=%a /etc/kubernetes/scheduler.conf; fi''","tests":{"test_items":[{"flag":"permissions","compare":{"op":"bitmask","value":"644"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchmod 644 /etc/kubernetes/scheduler.conf\n","scored":true},{"id":"1.1.16","text":"确保将scheduler.conf文件所有权设置为root:root (计入分数)","audit":"/bin/sh -c ''if test -e /etc/kubernetes/scheduler.conf; then stat -c %U:%G /etc/kubernetes/scheduler.conf; fi''","tests":{"test_items":[{"flag":"root:root","compare":{"op":"eq","value":"root:root"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchown root:root /etc/kubernetes/scheduler.conf\n","scored":true},{"id":"1.1.17","text":"Ensure that the controller-manager.conf file permissions are set to 644 or more restrictive (计入分数)","audit":"/bin/sh -c ''if test -e /etc/kubernetes/controller-manager.conf; then stat -c permissions=%a /etc/kubernetes/controller-manager.conf; fi''","tests":{"test_items":[{"flag":"permissions","compare":{"op":"bitmask","value":"644"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchmod 644 /etc/kubernetes/controller-manager.conf\n","scored":true},{"id":"1.1.18","text":"确保将controller-manager.conf文件所有权设置为root:root (计入分数)","audit":"/bin/sh -c ''if test -e /etc/kubernetes/controller-manager.conf; then stat -c %U:%G /etc/kubernetes/controller-manager.conf; fi''","tests":{"test_items":[{"flag":"root:root","compare":{"op":"eq","value":"root:root"},"set":true}]},"remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchown root:root /etc/kubernetes/controller-manager.conf\n","scored":true},{"id":"1.1.19","text":"Ensure that the Kubernetes PKI directory and file ownership is set to root:root (计入分数)","audit":"ls -laR /etc/kubernetes/pki/","type":"manual","remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchown -R root:root /etc/kubernetes/pki/\n","scored":true},{"id":"1.1.20","text":"Ensure that the Kubernetes PKI certificate file permissions are set to 644 or more restrictive (计入分数)","audit":"stat -c %n %a /etc/kubernetes/pki/*.crt","type":"manual","remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchmod -R 644 /etc/kubernetes/pki/*.crt\n","scored":true},{"id":"1.1.21","text":"Ensure that the Kubernetes PKI key file permissions are set to 600 (计入分数)","audit":"stat -c %n %a /etc/kubernetes/pki/*.key","type":"manual","remediation":"在主节点上，运行以下命令（基于系统上的文件位置）。例如\nchmod -R 600 /etc/kubernetes/pki/*.key\n","scored":true}]},{"id":1.2,"text":"API服务器","checks":[{"id":"1.2.1","text":"确保将--anonymous-auth参数设置为false (不计分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--anonymous-auth","compare":{"op":"eq","value":false},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf，设置以下参数 --anonymous-auth=false\n","scored":false},{"id":"1.2.2","text":"确保未设置--basic-auth-file参数 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--basic-auth-file","set":false}]},"remediation":"Follow the documentation and configure alternate mechanisms for authentication. Then,\nedit the API server pod specification file $apiserverconf\non the master node and remove the --basic-auth-file=<filename> parameter.\n","scored":true},{"id":"1.2.3","text":"确保未设置--token-auth-file参数 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--token-auth-file","set":false}]},"remediation":"Follow the documentation and configure alternate mechanisms for authentication. Then,\nedit the API server pod specification file $apiserverconf\non the master node and remove the --token-auth-file=<filename> parameter.\n","scored":true},{"id":"1.2.4","text":"确保将--kubelet-https参数设置为true (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--kubelet-https","compare":{"op":"eq","value":true},"set":true},{"flag":"--kubelet-https","set":false}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf，删除 --kubelet-https 参数。\n","scored":true},{"id":"1.2.5","text":"确保--kubelet-client-certificate和--kubelet-client- key参数设置为适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"and","test_items":[{"flag":"--kubelet-client-certificate","set":true},{"flag":"--kubelet-client-key","set":true}]},"remediation":"按照Kubernetes文档设置apiserver和kubelet之间的TLS连接。然后，在主节点上编辑API服务器Pod配置文件$apiserverconf ,设置kubelet客户端证书和关键参数，如下所示 --kubelet-client-certificate=<path/to/client-certificate-file> --kubelet-client-key=<path/to/client-key-file>\n","scored":true},{"id":"1.2.6","text":"确保--kubelet-certificate-authority参数设置为适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--kubelet-certificate-authority","set":true}]},"remediation":"Follow the Kubernetes documentation and setup the TLS connection between\nthe apiserver and kubelets. Then, edit the API server pod specification file\n$apiserverconf on the master node and set the\n--kubelet-certificate-authority parameter to the path to the cert file for the certificate authority.\n--kubelet-certificate-authority=<ca-string>\n","scored":true},{"id":"1.2.7","text":"确保--authorization-mode参数未设置为AlwaysAllow (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--authorization-mode","compare":{"op":"nothave","value":"AlwaysAllow"},"set":true}]},"remediation":"Edit the API server pod specification file $apiserverconf\non the master node and set the --authorization-mode parameter to values other than AlwaysAllow.\nOne such example could be as below.\n--authorization-mode=RBAC\n","scored":true},{"id":"1.2.8","text":"Ensure that the --authorization-mode argument includes Node (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--authorization-mode","compare":{"op":"has","value":"Node"},"set":true}]},"remediation":"Edit the API server pod specification file $apiserverconf\non the master node and set the --authorization-mode parameter to a value that includes Node.\n--authorization-mode=Node,RBAC\n","scored":true},{"id":"1.2.9","text":"确保--authorization-mode参数包含RBAC (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--authorization-mode","compare":{"op":"has","value":"RBAC"},"set":true}]},"remediation":"Edit the API server pod specification file $apiserverconf\non the master node and set the --authorization-mode parameter to a value that includes RBAC,\nfor example:\n--authorization-mode=Node,RBAC\n","scored":true},{"id":"1.2.10","text":"确保设置了许可控制插件EventRateLimit (不计分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--enable-admission-plugins","compare":{"op":"has","value":"EventRateLimit"},"set":true}]},"remediation":"Follow the Kubernetes documentation and set the desired limits in a configuration file.\nThen, edit the API server pod specification file $apiserverconf\nand set the below parameters.\n--enable-admission-plugins=...,EventRateLimit,...\n--admission-control-config-file=<path/to/configuration/file>\n","scored":false},{"id":"1.2.11","text":"确保未设置许可控制插件AlwaysAdmit (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--enable-admission-plugins","compare":{"op":"nothave","value":"AlwaysAdmit"},"set":true},{"flag":"--enable-admission-plugins","set":false}]},"remediation":"Edit the API server pod specification file $apiserverconf\non the master node and either remove the --enable-admission-plugins parameter, or set it to a\nvalue that does not include AlwaysAdmit.\n","scored":true},{"id":"1.2.12","text":"确保已设置许可控制插件AlwaysPullImages (不计分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--enable-admission-plugins","compare":{"op":"has","value":"AlwaysPullImages"},"set":true}]},"remediation":"Edit the API server pod specification file $apiserverconf\non the master node and set the --enable-admission-plugins parameter to include\nAlwaysPullImages.\n--enable-admission-plugins=...,AlwaysPullImages,...\n","scored":false},{"id":"1.2.13","text":"确保已设置许可控制插件SecurityContextDeny if PodSecurityPolicy is not used (不计分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--enable-admission-plugins","compare":{"op":"has","value":"SecurityContextDeny"},"set":true}]},"remediation":"Edit the API server pod specification file $apiserverconf\non the master node and set the --enable-admission-plugins parameter to include\nSecurityContextDeny, unless PodSecurityPolicy is already in place.\n--enable-admission-plugins=...,SecurityContextDeny,...\n","scored":false},{"id":"1.2.14","text":"确保设置了许可控制插件ServiceAccount  (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--disable-admission-plugins","compare":{"op":"nothave","value":"ServiceAccount"},"set":true},{"flag":"--disable-admission-plugins","set":false}]},"remediation":"Follow the documentation and create ServiceAccount objects as per your environment.\nThen, edit the API server pod specification file $apiserverconf\non the master node and ensure that the --disable-admission-plugins parameter is set to a\nvalue that does not include ServiceAccount.\n","scored":true},{"id":"1.2.15","text":"确保设置了许可控制插件NamespaceLifecycle (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--disable-admission-plugins","compare":{"op":"nothave","value":"NamespaceLifecycle"},"set":true},{"flag":"--disable-admission-plugins","set":false}]},"remediation":"Edit the API server pod specification file $apiserverconf\non the master node and set the --disable-admission-plugins parameter to\nensure it does not include NamespaceLifecycle.\n","scored":true},{"id":"1.2.16","text":"确保已设置许可控制插件PodSecurityPolicy (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--enable-admission-plugins","compare":{"op":"has","value":"PodSecurityPolicy"},"set":true}]},"remediation":"Follow the documentation and create Pod Security Policy objects as per your environment.\nThen, edit the API server pod specification file $apiserverconf\non the master node and set the --enable-admission-plugins parameter to a\nvalue that includes PodSecurityPolicy:\n--enable-admission-plugins=...,PodSecurityPolicy,...\nThen restart the API Server.\n","scored":true},{"id":"1.2.17","text":"确保设置了许可控制插件NodeRestriction (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--enable-admission-plugins","compare":{"op":"has","value":"NodeRestriction"},"set":true}]},"remediation":"Follow the Kubernetes documentation and configure NodeRestriction plug-in on kubelets.\nThen, edit the API server pod specification file $apiserverconf\non the master node and set the --enable-admission-plugins parameter to a\nvalue that includes NodeRestriction.\n--enable-admission-plugins=...,NodeRestriction,...\n","scored":true},{"id":"1.2.18","text":"确保未设置--insecure-bind-address参数 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--insecure-bind-address","set":false}]},"remediation":"Edit the API server pod specification file $apiserverconf\non the master node and remove the --insecure-bind-address parameter.\n","scored":true},{"id":"1.2.19","text":"确保将--insecure-port参数设置为0 0 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--insecure-port","compare":{"op":"eq","value":0},"set":true}]},"remediation":"Edit the API server pod specification file $apiserverconf\non the master node and set the below parameter.\n--insecure-port=0\n","scored":true},{"id":"1.2.20","text":"确保将--secure-port参数未设置为0 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--secure-port","compare":{"op":"gt","value":0},"set":true},{"flag":"--secure-port","set":false}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf，删除 --secure-port 参数或将其设置为其他（非零）端口。\n","scored":true},{"id":"1.2.21","text":"确保将--profiling参数设置为false (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--profiling","compare":{"op":"eq","value":false},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf，设置以下参数 --profiling=false\n","scored":true},{"id":"1.2.22","text":"Ensure that the --audit-log-path argument is set (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--audit-log-path","set":true}]},"remediation":"Edit the API server pod specification file $apiserverconf\non the master node and set the --audit-log-path parameter to a suitable path and\nfile where you would like audit logs to be written, for example:\n--audit-log-path=/var/log/apiserver/audit.log\n","scored":true},{"id":"1.2.23","text":"确保--audit-log-maxage参数设置为30或适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--audit-log-maxage","compare":{"op":"gte","value":30},"set":true}]},"remediation":"Edit the API server pod specification file $apiserverconf\non the master node and set the --audit-log-maxage parameter to 30 or as an appropriate number of days:\n--audit-log-maxage=30\n","scored":true},{"id":"1.2.24","text":"确保--audit-log-maxbackup参数设置为10或适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--audit-log-maxbackup","compare":{"op":"gte","value":10},"set":true}]},"remediation":"Edit the API server pod specification file $apiserverconf\non the master node and set the --audit-log-maxbackup parameter to 10 or to an appropriate\nvalue.\n--audit-log-maxbackup=10\n","scored":true},{"id":"1.2.25","text":"确保--audit-log-maxsize参数设置为100或适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--audit-log-maxsize","compare":{"op":"gte","value":100},"set":true}]},"remediation":"Edit the API server pod specification file $apiserverconf\non the master node and set the --audit-log-maxsize parameter to an appropriate size in MB.\nFor example, to set it as 100 MB:\n--audit-log-maxsize=100\n","scored":true},{"id":"1.2.26","text":"确保--request-timeout参数设置为适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--request-timeout","set":false},{"flag":"--request-timeout","set":true}]},"remediation":"Edit the API server pod specification file $apiserverconf\nand set the below parameter as appropriate and if needed.\nFor example,\n--request-timeout=300s\n","scored":true},{"id":"1.2.27","text":"确保--service-account-lookup参数设置为true (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--service-account-lookup","set":false},{"flag":"--service-account-lookup","compare":{"op":"eq","value":true},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf，设置以下参数 --service-account-lookup=true\nAlternatively, you can delete the --service-account-lookup parameter from this file so\nthat the default takes effect.\n","scored":true},{"id":"1.2.28","text":"确保--service-account-key-file参数设置为适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--service-account-key-file","set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf ，将--service-account-key-file参数设置为服务帐户的公钥文件：--service-account-key文件=<文件名>\n","scored":true},{"id":"1.2.29","text":"Ensure that the --etcd-certfile and --etcd-keyfile arguments are set as appropriate (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"and","test_items":[{"flag":"--etcd-certfile","set":true},{"flag":"--etcd-keyfile","set":true}]},"remediation":"Follow the Kubernetes documentation and set up the TLS connection between the apiserver and etcd.\nThen, edit the API server pod specification file $apiserverconf\non the master node and set the etcd certificate and key file parameters.\n--etcd-certfile=<path/to/client-certificate-file>\n--etcd-keyfile=<path/to/client-key-file>\n","scored":true},{"id":"1.2.30","text":"确保正确设置--tls-cert-file和--tls-private-key-file参数 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"bin_op":"and","test_items":[{"flag":"--tls-cert-file","set":true},{"flag":"--tls-private-key-file","set":true}]},"remediation":"Follow the Kubernetes documentation and set up the TLS connection on the apiserver.\nThen, edit the API server pod specification file $apiserverconf\non the master node and set the TLS certificate and private key file parameters.\n--tls-cert-file=<path/to/tls-certificate-file>\n--tls-private-key-file=<path/to/tls-key-file>\n","scored":true},{"id":"1.2.31","text":"确保将--client-ca-file参数设置为适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--client-ca-file","set":true}]},"remediation":"按照Kubernetes文档在apiserver上设置TLS连接。然后，在主节点上编辑API服务器Pod配置文件$apiserverconf ，\n设置客户端证书颁发机构文件。--client-ca-file=<path/to/client-ca-file>\n","scored":true},{"id":"1.2.32","text":"确保--etcd-cafile参数设置为适当的值 (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--etcd-cafile","set":true}]},"remediation":"Follow the Kubernetes documentation and set up the TLS connection between the apiserver and etcd.\nThen, edit the API server pod specification file $apiserverconf\non the master node and set the etcd certificate authority file parameter.\n--etcd-cafile=<path/to/ca-file>\n","scored":true},{"id":"1.2.33","text":"Ensure that the --encryption-provider-config argument is set as appropriate (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--encryption-provider-config","set":true}]},"remediation":"Follow the Kubernetes documentation and configure a EncryptionConfig file.\nThen, edit the API server pod specification file $apiserverconf\non the master node and set the --encryption-provider-config parameter to the path of that file: --encryption-provider-config=</path/to/EncryptionConfig/File>\n","scored":true},{"id":"1.2.34","text":"Ensure that encryption providers are appropriately configured (计入分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","type":"manual","remediation":"Follow the Kubernetes documentation and configure a EncryptionConfig file.\nIn this file, choose aescbc, kms or secretbox as the encryption provider.\n","scored":true},{"id":"1.2.35","text":"确保API服务器仅使用强加密密码 (不计分数)","audit":"/bin/ps -ef | grep $apiserverbin | grep -v grep","tests":{"test_items":[{"flag":"--tls-cipher-suites","compare":{"op":"has","value":"TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256"},"set":true}]},"remediation":"在主节点上编辑API服务器Pod配置文件$apiserverconf 设置以下参数 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM _SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM _SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM _SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256\n","scored":false}]},{"id":1.3,"text":"控制器管理","checks":[{"id":"1.3.1","text":"确保将--terminated-pod-gc-threshold参数设置合适 (计入分数)","audit":"/bin/ps -ef | grep $controllermanagerbin | grep -v grep","tests":{"test_items":[{"flag":"--terminated-pod-gc-threshold","set":true}]},"remediation":"Edit the Controller Manager pod specification file $controllermanagerconf\non the master node and set the --terminated-pod-gc-threshold to an appropriate threshold,\nfor example:\n--terminated-pod-gc-threshold=10\n","scored":true},{"id":"1.3.2","text":"确保将--profiling参数设置为false (计入分数)","audit":"/bin/ps -ef | grep $controllermanagerbin | grep -v grep","tests":{"test_items":[{"flag":"--profiling","compare":{"op":"eq","value":false},"set":true}]},"remediation":"在主节点上编辑Controller Manager Pod配置$controllermanagerconf ，设置以下参数\n--profiling=false\n","scored":true},{"id":"1.3.3","text":"确保将--use-service-account-credentials参数设置为true (计入分数)","audit":"/bin/ps -ef | grep $controllermanagerbin | grep -v grep","tests":{"test_items":[{"flag":"--use-service-account-credentials","compare":{"op":"noteq","value":false},"set":true}]},"remediation":"编辑Controller Manager Pod配置文件$controllermanagerconf 在主节点上，设置以下参数\n--use-service-account-credentials=true\n","scored":true},{"id":"1.3.4","text":"确保将--service-account-private-key-file参数设置为适当的值 (计入分数)","audit":"/bin/ps -ef | grep $controllermanagerbin | grep -v grep","tests":{"test_items":[{"flag":"--service-account-private-key-file","set":true}]},"remediation":"Edit the Controller Manager pod specification file $controllermanagerconf\non the master node and set the --service-account-private-key-file parameter\nto the private key file for service accounts.\n--service-account-private-key-file=<filename>\n","scored":true},{"id":"1.3.5","text":"确保正确设置--root-ca-file参数 (计入分数)","audit":"/bin/ps -ef | grep $controllermanagerbin | grep -v grep","tests":{"test_items":[{"flag":"--root-ca-file","set":true}]},"remediation":"Edit the Controller Manager pod specification file $controllermanagerconf\non the master node and set the --root-ca-file parameter to the certificate bundle file.\n--root-ca-file=<path/to/file>\n","scored":true},{"id":"1.3.6","text":"确保将RotateKubeletServerCertificate参数设置为true (计入分数)","audit":"/bin/ps -ef | grep $controllermanagerbin | grep -v grep","tests":{"test_items":[{"flag":"--feature-gates","compare":{"op":"eq","value":"RotateKubeletServerCertificate=true"},"set":true}]},"remediation":"Edit the Controller Manager pod specification file $controllermanagerconf\non the master node and set the --feature-gates parameter to include RotateKubeletServerCertificate=true.\n--feature-gates=RotateKubeletServerCertificate=true\n","scored":true},{"id":"1.3.7","text":"Ensure that the --bind-address argument is set to 127.0.0.1 (计入分数)","audit":"/bin/ps -ef | grep $controllermanagerbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--bind-address","compare":{"op":"eq","value":"127.0.0.1"},"set":true},{"flag":"--bind-address","set":false}]},"remediation":"Edit the Controller Manager pod specification file $controllermanagerconf\non the master node and ensure the correct value for the --bind-address parameter\n","scored":true}]},{"id":1.4,"text":"调度程序","checks":[{"id":"1.4.1","text":"确保将--profiling参数设置为false (计入分数)","audit":"/bin/ps -ef | grep $schedulerbin | grep -v grep","tests":{"test_items":[{"flag":"--profiling","compare":{"op":"eq","value":false},"set":true}]},"remediation":"Edit the Scheduler pod specification file $schedulerconf file\non the master node and set the below parameter.\n--profiling=false\n","scored":true},{"id":"1.4.2","text":"Ensure that the --bind-address argument is set to 127.0.0.1 (计入分数)","audit":"/bin/ps -ef | grep $schedulerbin | grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--bind-address","compare":{"op":"eq","value":"127.0.0.1"},"set":true},{"flag":"--bind-address","set":false}]},"remediation":"Edit the Scheduler pod specification file $schedulerconf\non the master node and ensure the correct value for the --bind-address parameter\n","scored":true}]}]}', '{"controls":null,"version":1.5,"id":4,"text":"Worker Node 安全配置要求","type":"node","groups":[{"id":4.1,"text":"Worker Node Configuration Files","checks":[{"id":"4.1.1","text":"确保将kubelet.conf文件所有权设置为root:root (计入分数)","audit":"/bin/sh -c ''if test -e $kubeletsvc; then stat -c permissions=%a $kubeletsvc; fi'' ","tests":{"test_items":[{"flag":"permissions","set":true,"compare":{"op":"bitmask","value":"644"}}]},"remediation":"Run the below command (based on the file location on your system) on the each worker node.\nFor example,\nchmod 644 $kubeletsvc\n","scored":true},{"id":"4.1.2","text":"确保将kubelet service文件所有权设置为root:root (计入分数)","audit":"/bin/sh -c ''if test -e $kubeletsvc; then stat -c %U:%G $kubeletsvc; fi'' ","tests":{"test_items":[{"flag":"root:root","set":true}]},"remediation":"Run the below command (based on the file location on your system) on the each worker node.\nFor example,\nchown root:root $kubeletsvc\n","scored":true},{"id":"4.1.3","text":"确保将kubeconfig文件权限设置为644或更严格 (计入分数)","audit":"/bin/sh -c ''if test -e $proxykubeconfig; then stat -c permissions=%a $proxykubeconfig; fi'' ","tests":{"test_items":[{"flag":"permissions","set":true,"compare":{"op":"bitmask","value":"644"}}]},"remediation":"Run the below command (based on the file location on your system) on the each worker node.\nFor example,\nchmod 644 $proxykubeconfig\n","scored":true},{"id":"4.1.4","text":"确保将kubeconfig文件所有权设置为root:root (计入分数)","audit":"/bin/sh -c ''if test -e $proxykubeconfig; then stat -c %U:%G $proxykubeconfig; fi'' ","tests":{"test_items":[{"flag":"root:root","set":true}]},"remediation":"Run the below command (based on the file location on your system) on the each worker node.\nFor example, chown root:root $proxykubeconfig\n","scored":true},{"id":"4.1.5","text":"确保将kubelet service文件权限设置为644或更严格 (计入分数)","audit":"/bin/sh -c ''if test -e $kubeletkubeconfig; then stat -c permissions=%a $kubeletkubeconfig; fi'' ","tests":{"test_items":[{"flag":"permissions","set":true,"compare":{"op":"bitmask","value":"644"}}]},"remediation":"Run the below command (based on the file location on your system) on the each worker node.\nFor example,\nchmod 644 $kubeletkubeconfig\n","scored":true},{"id":"4.1.6","text":"确保将kubelet.conf文件权限设置为644或更严格 (计入分数)","audit":"/bin/sh -c ''if test -e $kubeletkubeconfig; then stat -c %U:%G $kubeletkubeconfig; fi'' ","tests":{"test_items":[{"flag":"root:root","set":true,"compare":{"op":"eq","value":"root:root"}}]},"remediation":"Run the below command (based on the file location on your system) on the each worker node.\nFor example,\nchown root:root $kubeletkubeconfig\n","scored":true},{"id":"4.1.7","text":"确保kubelet配置文件的权限设置为644或更严格 (计入分数)","types":"manual","remediation":"Run the following command to modify the file permissions of the\n--client-ca-file chmod 644 <filename>\n","scored":true},{"id":"4.1.8","text":"确保将client certificate authorities文件所有权设置为root:root (计入分数)","audit":"CAFILE=$(ps -ef | grep kubelet | grep -v apiserver | grep -- --client-ca-file= | awk -F ''--client-ca-file='' ''{print $2}'' | awk ''{print $1}'')\nif [[ -z $CAFILE ]]; then\n  CAFILE=$kubeletcafile\nfi\nif test -e $CAFILE; then stat -c %U:%G $CAFILE; fi\n","tests":{"test_items":[{"flag":"root:root","set":true,"compare":{"op":"eq","value":"root:root"}}]},"remediation":"Run the following command to modify the ownership of the --client-ca-file.\nchown root:root <filename>\n","scored":true},{"id":"4.1.9","text":"确保kubelet配置文件的权限设置为644或更严格 (计入分数)","audit":"/bin/sh -c ''if test -e $kubeletconf; then stat -c permissions=%a $kubeletconf; fi'' ","tests":{"test_items":[{"flag":"permissions","set":true,"compare":{"op":"bitmask","value":"644"}}]},"remediation":"运行以下命令（使用在审计步骤中的配置文件位置）\nchmod 644 $kubeletconf\n","scored":true},{"id":"4.1.10","text":"确保kubelet配置文件的用户为root:root (计入分数)","audit":"/bin/sh -c ''if test -e $kubeletconf; then stat -c %U:%G $kubeletconf; fi'' ","tests":{"test_items":[{"flag":"root:root","set":true}]},"remediation":"运行以下命令（使用在审计步骤中的配置文件位置）\nchown root:root $kubeletconf\n","scored":true}]},{"id":4.2,"text":"Kubelet","checks":[{"id":"4.2.1","text":"确保将--anonymous-auth参数设置为false (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--anonymous-auth","path":"{.authentication.anonymous.enabled}","set":true,"compare":{"op":"eq","value":false}}]},"remediation":"If using a Kubelet config file, edit the file to set authentication: anonymous: enabled to\nfalse.\nIf using executable arguments, edit the kubelet service file\n$kubeletsvc on each worker node and\nset the below parameter in KUBELET_SYSTEM_PODS_ARGS variable.\n--anonymous-auth=false\nBased on your system, restart the kubelet service. For example:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"4.2.2","text":"确保--authorization-mode参数未设置为AlwaysAllow (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--authorization-mode","path":"{.authorization.mode}","set":true,"compare":{"op":"nothave","value":"AlwaysAllow"}}]},"remediation":"If using a Kubelet config file, edit the file to set authorization: mode to Webhook. If\nusing executable arguments, edit the kubelet service file\n$kubeletsvc on each worker node and\nset the below parameter in KUBELET_AUTHZ_ARGS variable.\n--authorization-mode=Webhook\nBased on your system, restart the kubelet service. For example:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"4.2.3","text":"确保将--client-ca-file参数设置为适当的值 (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--client-ca-file","path":"{.authentication.x509.clientCAFile}","set":true}]},"remediation":"如果使用Kubelet配置文件，请编辑该文件设置 authentication: x509: clientCAFile 为客户端CA文件的位置。如果使用命令行参数，请在每个工作节点上编辑kubelet服务文件$kubeletsvc ，在 KUBELET_AUTHZ_ARGS 变量中设置以下参数 --client-ca-file=<path/to/client-ca-file> 根据您的系统，重新启动 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"4.2.4","text":"确保将--read-only-port参数设置为0 (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--read-only-port","path":"{.readOnlyPort}","set":true,"compare":{"op":"eq","value":0}}]},"remediation":"If using a Kubelet config file, edit the file to set readOnlyPort to 0.\nIf using command line arguments, edit the kubelet service file\n$kubeletsvc on each worker node and\nset the below parameter in KUBELET_SYSTEM_PODS_ARGS variable.\n--read-only-port=0\nBased on your system, restart the kubelet service. For example:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"4.2.5","text":"确保--streaming-connection-idle-timeout参数未设置为0 (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--streaming-connection-idle-timeout","path":"{.streamingConnectionIdleTimeout}","set":true,"compare":{"op":"noteq","value":0}},{"flag":"--streaming-connection-idle-timeout","path":"{.streamingConnectionIdleTimeout}","set":false}],"bin_op":"or"},"remediation":"如果使用Kubelet配置文件，请编辑该文件设置 streamingConnectionIdleTimeout 为除0以外的值.如果使用命令行参数，请在每个工作节点上编辑kubelet服务文件$kubeletsvc ，在 KUBELET_SYSTEM_PODS_ARGS 变量中设置以下参数 --streaming-connection-idle-timeout=5m 根据您的系统，重启 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"4.2.6","text":"确保--protect-kernel-defaults参数设置为true (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--protect-kernel-defaults","path":"{.protectKernelDefaults}","set":true,"compare":{"op":"eq","value":true}}]},"remediation":"If using a Kubelet config file, edit the file to set protectKernelDefaults: true.\nIf using command line arguments, edit the kubelet service file\n$kubeletsvc on each worker node and\nset the below parameter in KUBELET_SYSTEM_PODS_ARGS variable.\n--protect-kernel-defaults=true\nBased on your system, restart the kubelet service. For example:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"4.2.7","text":"确保--make-iptables-util-chains参数设置为true (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--make-iptables-util-chains","path":"{.makeIPTablesUtilChains}","set":true,"compare":{"op":"eq","value":true}},{"flag":"--make-iptables-util-chains","path":"{.makeIPTablesUtilChains}","set":false}],"bin_op":"or"},"remediation":"If using a Kubelet config file, edit the file to set makeIPTablesUtilChains: true.\nIf using command line arguments, edit the kubelet service file\n$kubeletsvc on each worker node and\nremove the --make-iptables-util-chains argument from the\nKUBELET_SYSTEM_PODS_ARGS variable.\nBased on your system, restart the kubelet service. For example:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"4.2.8","text":"确保未设置--hostname-override参数 (不计分数)","audit":"/bin/ps -fC $kubeletbin ","tests":{"test_items":[{"flag":"--hostname-override","set":false}]},"remediation":"编辑kubelet服务文件$kubeletsvc 在每个工作节点上，从 KUBELET_CERTIFICATE_ARGS 变量中删除 —hostname-override。 根据您的系统，重新启动 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":false},{"id":"4.2.9","text":"确保将--event-qps参数设置为0 or a level which ensures appropriate event capture (不计分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--event-qps","path":"{.eventRecordQPS}","set":true,"compare":{"op":"eq","value":0}}]},"remediation":"If using a Kubelet config file, edit the file to set eventRecordQPS: to an appropriate level.\nIf using command line arguments, edit the kubelet service file\n$kubeletsvc on each worker node and\nset the below parameter in KUBELET_SYSTEM_PODS_ARGS variable.\nBased on your system, restart the kubelet service. For example:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":false},{"id":"4.2.10","text":"确保正确设置--tls-cert-file和--tls-private-key-file参数 (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--tls-cert-file","path":"{.tlsCertFile}","set":true},{"flag":"--tls-private-key-file","path":"{.tlsPrivateKeyFile}","set":true}]},"remediation":"If using a Kubelet config file, edit the file to set tlsCertFile to the location\nof the certificate file to use to identify this Kubelet, and tlsPrivateKeyFile\nto the location of the corresponding private key file.\nIf using command line arguments, edit the kubelet service file\n$kubeletsvc on each worker node and\nset the below parameters in KUBELET_CERTIFICATE_ARGS variable.\n--tls-cert-file=<path/to/tls-certificate-file>\n--tls-private-key-file=<path/to/tls-key-file>\nBased on your system, restart the kubelet service. For example:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"4.2.11","text":"确保--rotate-certificates参数未设置为false (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--rotate-certificates","path":"{.rotateCertificates}","set":true,"compare":{"op":"eq","value":true}},{"flag":"--rotate-certificates","path":"{.rotateCertificates}","set":false}],"bin_op":"or"},"remediation":"If using a Kubelet config file, edit the file to add the line rotateCertificates: true or\nremove it altogether to use the default value.\nIf using command line arguments, edit the kubelet service file\n$kubeletsvc on each worker node and\nremove --rotate-certificates=false argument from the KUBELET_CERTIFICATE_ARGS\nvariable.\nBased on your system, restart the kubelet service. For example:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"4.2.12","text":"确保将RotateKubeletServerCertificate参数设置为true (计入分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"RotateKubeletServerCertificate","path":"{.featureGates.RotateKubeletServerCertificate}","set":true,"compare":{"op":"eq","value":true}}]},"remediation":"编辑kubelet服务文件$kubeletsvc 在每个工作节点上，在 KUBELET_CERTIFICATE_ARGS 变量中设置以下参数 --feature-gates=RotateKubeletServerCertificate=true 根据您的系统，重新启动 kubelet 服务。例如:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":true},{"id":"4.2.13","text":"确保Kubelet仅使用强加密密码 (不计分数)","audit":"/bin/ps -fC $kubeletbin","audit_config":"/bin/cat $kubeletconf","tests":{"test_items":[{"flag":"--tls-cipher-suites","path":"{range .tlsCipherSuites[:]}{}{'',''}{end}","set":true,"compare":{"op":"valid_elements","value":"TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256"}}]},"remediation":"如果使用Kubelet配置文件，编辑该文件设置 TLSCipherSuites 为:\nTLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256\nor to a subset of these values.\nIf using executable arguments, edit the kubelet service file\n$kubeletsvc on each worker node and\nset the --tls-cipher-suites parameter as follows, or to a subset of these values.\n--tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256\nBased on your system, restart the kubelet service. For example:\nsystemctl daemon-reload\nsystemctl restart kubelet.service\n","scored":false}]}]}', '{"controls":null,"version":1.5,"id":3,"text":"Control Plane Configuration","type":"controlplane","groups":[{"id":3.1,"text":"Authentication and Authorization","checks":[{"id":"3.1.1","text":"Client certificate authentication should not be used for users (不计分数)","type":"manual","remediation":"Alternative mechanisms provided by Kubernetes such as the use of OIDC should be\nimplemented in place of client certificates.\n","scored":false}]},{"id":3.2,"text":"Logging","checks":[{"id":"3.2.1","text":"Ensure that a minimal audit policy is created (计入分数)","type":"manual","remediation":"Create an audit policy file for your cluster.\n","scored":true},{"id":"3.2.2","text":"Ensure that the audit policy covers key security concerns (不计分数)","type":"manual","remediation":"Consider modification of the audit policy in use on the cluster to include these items, at a\nminimum.\n","scored":false}]}]}', '{"controls":null,"version":1.15,"id":2,"text":"Etcd Node Configuration","type":"etcd","groups":[{"id":2,"text":"Etcd Node Configuration Files","checks":[{"id":2.1,"text":"确保将--cert-file和--key-file参数设置为适当的值 (计入分数)","audit":"/bin/ps -ef | /bin/grep $etcdbin | /bin/grep -v grep","tests":{"bin_op":"and","test_items":[{"flag":"--cert-file","set":true},{"flag":"--key-file","set":true}]},"remediation":"Follow the etcd service documentation and configure TLS encryption.\nThen, edit the etcd pod specification file /etc/kubernetes/manifests/etcd.yaml\non the master node and set the below parameters.\n--cert-file=</path/to/ca-file>\n--key-file=</path/to/key-file>\n","scored":true},{"id":2.2,"text":"确保将--client-cert-auth参数设置为true (计入分数)","audit":"/bin/ps -ef | /bin/grep $etcdbin | /bin/grep -v grep","tests":{"test_items":[{"flag":"--client-cert-auth","compare":{"op":"eq","value":true},"set":true}]},"remediation":"在主节点上编辑etcd Pod配置文件$etcdconf ，设置以下参数\n--client-cert-auth=\"true\"\n","scored":true},{"id":2.3,"text":"确保--auto-tls参数未设置为true (计入分数)","audit":"/bin/ps -ef | /bin/grep $etcdbin | /bin/grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--auto-tls","set":false},{"flag":"--auto-tls","compare":{"op":"eq","value":false}}]},"remediation":"在主节点上编辑etcd Pod配置文件$etcdconf ，删除 --auto-tls 参数或将其设置为 false。\n  --auto-tls=false\n","scored":true},{"id":2.4,"text":"确保正确设置--peer-cert-file和--peer-key-file参数 (计入分数)","audit":"/bin/ps -ef | /bin/grep $etcdbin | /bin/grep -v grep","tests":{"bin_op":"and","test_items":[{"flag":"--peer-cert-file","set":true},{"flag":"--peer-key-file","set":true}]},"remediation":"按照etcd服务文档根据您的etcd群集配置对等TLS加密。然后，在主节点上编辑etcd Pod配置文件$etcdconf ，设置以下参数\n--peer-client-file=</path/to/peer-cert-file>\n--peer-key-file=</path/to/peer-key-file>\n","scored":true},{"id":2.5,"text":"确保将--peer-client-cert-auth参数设置为true (计入分数)","audit":"/bin/ps -ef | /bin/grep $etcdbin | /bin/grep -v grep","tests":{"test_items":[{"flag":"--peer-client-cert-auth","compare":{"op":"eq","value":true},"set":true}]},"remediation":"在主节点上编辑etcd Pod配置文件$etcdconf ，设置以下参数\n--peer-client-cert-auth=true\n","scored":true},{"id":2.6,"text":"确保--peer-auto-tls参数未设置为true (计入分数)","audit":"/bin/ps -ef | /bin/grep $etcdbin | /bin/grep -v grep","tests":{"bin_op":"or","test_items":[{"flag":"--peer-auto-tls","set":false},{"flag":"--peer-auto-tls","compare":{"op":"eq","value":false},"set":true}]},"remediation":"在主节点上编辑etcd Pod配置文件$etcdconf ，删除 --peer-auto-tls 参数或将其设置为 false。\n--peer-auto-tls=false\n","scored":true},{"id":2.7,"text":"确保将唯一的证书颁发机构用于etcd (不计分数)","audit":"/bin/ps -ef | /bin/grep $etcdbin | /bin/grep -v grep","tests":{"test_items":[{"flag":"--trusted-ca-file","set":true}]},"remediation":"[手动测试]\n按照etcd文档为etcd服务创建专用的证书颁发机构设置。 然后，在主节点上编辑etcd Pod配置文件$etcdconf ，设置以下参数\n--trusted-ca-file=</path/to/ca-file>\n","scored":false}]}]}', '{"controls":null,"version":1.5,"id":5,"text":"Kubernetes Policies","type":"policies","groups":[{"id":5.1,"text":"RBAC and Service Accounts","checks":[{"id":"5.1.1","text":"确保仅在需要时使用集群管理员角色 (不计分数)","type":"manual","remediation":"Identify all clusterrolebindings to the cluster-admin role. Check if they are used and\nif they need this role or if they could use a role with fewer privileges.\nWhere possible, first bind users to a lower privileged role and then remove the\nclusterrolebinding to the cluster-admin role :\nkubectl delete clusterrolebinding [name]\n","scored":false},{"id":"5.1.2","text":"Minimize access to secrets (不计分数)","type":"manual","remediation":"Where possible, remove get, list and watch access to secret objects in the cluster.\n","scored":false},{"id":"5.1.3","text":"Minimize wildcard use in Roles and ClusterRoles (不计分数)","type":"manual","remediation":"Where possible replace any use of wildcards in clusterroles and roles with specific\nobjects or actions.\n","scored":false},{"id":"5.1.4","text":"Minimize access to create pods (不计分数)","type":"manual","remediation":"Where possible, remove create access to pod objects in the cluster.\n","scored":false},{"id":"5.1.5","text":"Ensure that default service accounts are not actively used. (计入分数)","type":"manual","remediation":"Create explicit service accounts wherever a Kubernetes workload requires specific access\nto the Kubernetes API server.\nModify the configuration of each default service account to include this value\nautomountServiceAccountToken: false\n","scored":true},{"id":"5.1.6","text":"Ensure that Service Account Tokens are only mounted where necessary (不计分数)","type":"manual","remediation":"Modify the definition of pods and service accounts which do not need to mount service\naccount tokens to disable it.\n","scored":false}]},{"id":5.2,"text":"Pod Security Policies","checks":[{"id":"5.2.1","text":"Minimize the admission of privileged containers (不计分数)","type":"manual","remediation":"Create a PSP as described in the Kubernetes documentation, ensuring that\nthe .spec.privileged field is omitted or set to false.\n","scored":false},{"id":"5.2.2","text":"Minimize the admission of containers wishing to share the host process ID namespace (计入分数)","type":"manual","remediation":"Create a PSP as described in the Kubernetes documentation, ensuring that the\n.spec.hostPID field is omitted or set to false.\n","scored":true},{"id":"5.2.3","text":"Minimize the admission of containers wishing to share the host IPC namespace (计入分数)","type":"manual","remediation":"Create a PSP as described in the Kubernetes documentation, ensuring that the\n.spec.hostIPC field is omitted or set to false.\n","scored":true},{"id":"5.2.4","text":"Minimize the admission of containers wishing to share the host network namespace (计入分数)","type":"manual","remediation":"Create a PSP as described in the Kubernetes documentation, ensuring that the\n.spec.hostNetwork field is omitted or set to false.\n","scored":true},{"id":"5.2.5","text":"Minimize the admission of containers with allowPrivilegeEscalation (计入分数)","type":"manual","remediation":"Create a PSP as described in the Kubernetes documentation, ensuring that the\n.spec.allowPrivilegeEscalation field is omitted or set to false.\n","scored":true},{"id":"5.2.6","text":"Minimize the admission of root containers (不计分数)","type":"manual","remediation":"Create a PSP as described in the Kubernetes documentation, ensuring that the\n.spec.runAsUser.rule is set to either MustRunAsNonRoot or MustRunAs with the range of\nUIDs not including 0.\n","scored":false},{"id":"5.2.7","text":"Minimize the admission of containers with the NET_RAW capability (不计分数)","type":"manual","remediation":"Create a PSP as described in the Kubernetes documentation, ensuring that the\n.spec.requiredDropCapabilities is set to include either NET_RAW or ALL.\n","scored":false},{"id":"5.2.8","text":"Minimize the admission of containers with added capabilities (不计分数)","type":"manual","remediation":"Ensure that allowedCapabilities is not present in PSPs for the cluster unless\nit is set to an empty array.\n","scored":false},{"id":"5.2.9","text":"Minimize the admission of containers with capabilities assigned (不计分数)","type":"manual","remediation":"Review the use of capabilites in applications runnning on your cluster. Where a namespace\ncontains applicaions which do not require any Linux capabities to operate consider adding\na PSP which forbids the admission of containers which do not drop all capabilities.\n","scored":false}]},{"id":5.3,"text":"Network Policies and CNI","checks":[{"id":"5.3.1","text":"Ensure that the CNI in use supports Network Policies (不计分数)","type":"manual","remediation":"If the CNI plugin in use does not support network policies, consideration should be given to\nmaking use of a different plugin, or finding an alternate mechanism for restricting traffic\nin the Kubernetes cluster.\n","scored":false},{"id":"5.3.2","text":"Ensure that all Namespaces have Network Policies defined (计入分数)","type":"manual","remediation":"按照文档根据需要创建NetworkPolicy对象。\n","scored":true}]},{"id":5.4,"text":"Secrets Management","checks":[{"id":"5.4.1","text":"Prefer using secrets as files over secrets as environment variables (不计分数)","type":"manual","remediation":"if possible, rewrite application code to read secrets from mounted secret files, rather than\nfrom environment variables.\n","scored":false},{"id":"5.4.2","text":"Consider external secret storage (不计分数)","type":"manual","remediation":"Refer to the secrets management options offered by your cloud provider or a third-party\nsecrets management solution.\n","scored":false}]},{"id":5.5,"text":"Extensible Admission Control","checks":[{"id":"5.5.1","text":"使用ImagePolicyWebhook许可控制器配置Image Provenance (不计分数)","type":"manual","remediation":"按照Kubernetes文档设置Image Provenance。\n","scored":false}]},{"id":5.6,"text":"General Policies","checks":[{"id":"5.6.1","text":"使用命名空间在资源之间创建管理边界 (不计分数)","type":"manual","remediation":"Follow the documentation and create namespaces for objects in your deployment as you need\nthem.\n","scored":false},{"id":"5.6.2","text":"Ensure that the seccomp profile is set to docker/default in your pod definitions (不计分数)","type":"manual","remediation":"Seccomp目前是一个alpha功能。 默认情况下，禁用所有Alpha功能。 因此，您需要通过传递\"--featuregates=AllAlpha=true\"参数来启用apiserver中的alpha功能。\nEdit the /etc/kubernetes/apiserver file on the master node and set the KUBE_API_ARGS\nparameter to \"--feature-gates=AllAlpha=true\"\nKUBE_API_ARGS=\"--feature-gates=AllAlpha=true\"\n根据您的系统，重新启动kube-apiserver服务。 例如：\nsystemctl restart kube-apiserver.service\n使用注释在pod定义中启用docker/default seccomp配置文件。 一个例子如下：\napiVersion: v1\nkind: Pod\nmetadata:\n  name: trustworthy-pod\n  annotations:\n    seccomp.security.alpha.kubernetes.io/pod: docker/default\nspec:\n  containers:\n    - name: trustworthy-container\n      image: sotrustworthy:latest\n","scored":false},{"id":"5.6.3","text":"将Security Context应用于您的Pod和容器 (不计分数)","type":"manual","remediation":"按照Kubernetes文档将Security Context应用到您的pod。 有关Security Context的建议列表，您可以参考Docker容器的CIS安全基准。\n","scored":false},{"id":"5.6.4","text":"The default namespace should not be used (计入分数)","type":"manual","remediation":"Ensure that namespaces are created to allow for appropriate segregation of Kubernetes\nresources and that all new resources are created in a specific namespace.\n","scored":true}]}]}', null, null, null, null, null, null, null, null, null); END IF; END $do$;`
	// template - ImageVulnScan
	DefaultHostImageVulnScanSql = `DO $do$ BEGIN IF NOT EXISTS (SELECT from system_template WHERE id='9b4320a4-57f5-4559-a91b-d84b0d0a0e92') THEN INSERT INTO "public"."system_template" ("id","account","name","description","type","version","status","is_default") VALUES ('9b4320a4-57f5-4559-a91b-d84b0d0a0e92','admin','主机镜像漏洞扫描','','HostImageVulnScan','1.0','Enable','t'); END IF; END $do$;`
	DefaultImageVulnScanSql     = `DO $do$ BEGIN IF NOT EXISTS (SELECT from system_template WHERE id='9b4320a4-57f5-4559-a91b-d84b0d0a0e93') THEN INSERT INTO "public"."system_template" ("id","account","name","description","type","version","status","is_default") VALUES ('9b4320a4-57f5-4559-a91b-d84b0d0a0e93','admin','镜像漏洞扫描','','ImageVulnScan','1.0','Enable','t'); END IF; END $do$;`
	// template - KubeVulnScan
	DefaultKubeVulnScanSql = `DO $do$ BEGIN IF NOT EXISTS (SELECT from system_template WHERE id='9b4320a4-57f5-4559-a91b-d84b0d0a0e94') THEN INSERT INTO "public"."system_template" ("id","account","name","description","type","version","status","is_default") VALUES ('9b4320a4-57f5-4559-a91b-d84b0d0a0e94','admin','集群漏洞扫描','','KubernetesVulnScan','1.0','Enable','t'); END IF; END $do$;`
	// template - DockerVulnScan
	DefaultDockerVulnScanSql = `DO $do$ BEGIN IF NOT EXISTS (SELECT from system_template WHERE id='9b4320a4-57f5-4559-a91b-d84b0d0a0e96') THEN INSERT INTO public.system_template (id, account, name, description, type, version, commands, status, is_default, config_mode, default_targets, check_master_json, check_node_json, check_control_plane_json, check_etcd_json, check_policies_json, check_managed_services_json, check_ids_master, check_ids_node, check_ids_control_plane, check_ids_etcd, check_ids_policies, check_ids_managed_services, check_ids_docker, check_ids_docker_check, check_ids, default_path_list, engine_code) VALUES ('9b4320a4-57f5-4559-a91b-d84b0d0a0e96', 'admin', 'Docker漏洞扫描', '', 'DockerVulnScan', '1.0', null, 'Enable', true, 'all', null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null); END IF; END $do$;`

	// system config
	WarningInfoConfig       = `DO $do$ BEGIN IF NOT EXISTS (SELECT from sys_config WHERE id='49efb8fb-6369-4ef6-9798-386d37179c2d') THEN INSERT INTO public.sys_config (id, key, value) VALUES ('49efb8fb-6369-4ef6-9798-386d37179c2d', 'WarningInfo', '{"Enable":true}'); END IF; END $do$;`
	DefaultMailServerConfig = `DO $do$ BEGIN IF NOT EXISTS (SELECT from sys_config WHERE id='84d0b176-c88c-4a33-bde2-471687bb8bf1') THEN INSERT INTO public.sys_config (id, key, value) VALUES ('84d0b176-c88c-4a33-bde2-471687bb8bf1', 'EmailServerConfig', '{"EmailServer":"","EmailServerPort":null,"UserName":"","Password":"","MailFrom": "","SendToEmail":"","MailTo":""}'); END IF; END $do$;`
	DefaultMailLogConfig    = `DO $do$ BEGIN IF NOT EXISTS (SELECT from sys_config WHERE id='b67544f2-524d-4694-8f63-86ea2e178885') THEN INSERT INTO public.sys_config (id, key, value) VALUES ('b67544f2-524d-4694-8f63-86ea2e178885', 'LogToMail', '{"BenchmarkLog":{"Enable":false,"Level_High":false,"Level_Medium":false,"Level_Low":false},"ImageSecurityLog":{"Enable":false,"Level_High":false,"Level_Medium":false,"Level_Low":false},"IntrudeDetectLog":{"Enable":false,"Level_High":false,"Level_Medium":false,"Level_Low":false},"ContainerSecurityAuditLog":{"Enable":false,"Level_High":false,"Level_Medium":false,"Level_Low":false},"CommandSecurityAuditLog":{"Enable":false,"Level_High":false,"Level_Medium":false,"Level_Low":false}}'); END IF; END $do$;`
	DefaultLDAPClientConfig = `DO $do$ BEGIN IF NOT EXISTS (SELECT from sys_config WHERE id='bc9e5911-42e1-4a40-8b00-1787bc487bb6') THEN INSERT INTO public.sys_config (id, key, value) VALUES ('bc9e5911-42e1-4a40-8b00-1787bc487bb6', 'LDAPClientConfig', '{"Enable":false,"Addr":"","Port":389,"BaseDn":"","BindDn":"", "BindPass":"", "AuthFilter":"","Attributes":[],"TLS":false,"StartTLS":false}'); END IF; END $do$;`
	WarningWhiteListConfig  = `DO $do$ BEGIN IF NOT EXISTS (SELECT from sys_config WHERE id='CDAE8EA6-FCFA-4981-B764-D2E1C98818B7') THEN INSERT INTO public.sys_config (id, key, value) VALUES ('CDAE8EA6-FCFA-4981-B764-D2E1C98818B7', 'WarnWhiteList', '{"Enable":true}'); END IF; END $do$;`
)
